---
title: استكشاف مشكلات الأداء وإصلاحها في تكوينات التقارير الإلكترونية
description: يشرح هذا الموضوع كيفية البحث عن مشكلات الأداء وإصلاحها في تكوينات التقارير الإلكترونية (ER).
author: NickSelin
ms.date: 06/08/2021
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: ERModelMappingDesigner, EROperationDesigner, ERFormatMappingRunJobTable, ERParameters, ERSolutionTable
audience: Application User, Developer, IT Pro
ms.reviewer: kfend
ms.custom: 220314
ms.assetid: ''
ms.search.region: Global
ms.author: maximbel
ms.search.validFrom: 2021-04-01
ms.dyn365.ops.version: 10.0.1
ms.openlocfilehash: b5f5308f171b6cd4224debec897dbde133e6d8424673aabfab51e6b83b9014e2
ms.sourcegitcommit: 42fe9790ddf0bdad911544deaa82123a396712fb
ms.translationtype: HT
ms.contentlocale: ar-SA
ms.lasthandoff: 08/05/2021
ms.locfileid: "6744376"
---
# <a name="troubleshooting-performance-issues-in-er-configurations"></a>استكشاف مشكلات الأداء وإصلاحها في تكوينات التقارير الإلكترونية

يشرح هذا الموضوع كيفية البحث عن مشكلات الأداء وحلها في [التقارير الإلكترونية](general-electronic-reporting.md) (ER) [تكوينات](general-electronic-reporting.md#Configuration).

بشكل عام، يتكون تحقيق الأداء من عدة خطوات.

1. [جمع](#collecting-data) البيانات.
2. قم بتحليل البيانات التي تم جمعها.
3. استنادًا إلى نتائج التحليل، استخدم تكوينات التقارير الإلكترونية [لإجراء التغييرات](#making-changes)، أو قرر جمع المزيد من البيانات.

## <a name="troubleshooting"></a>استكشاف الأخطاء وإصلاحها

### <a name="analyze-execution-time"></a>تحليل وقت التنفيذ

يمكن أن يعتمد وقت التنفيذ على عوامل غير متوقعة، مثل المهام الأخرى التي يتم تشغيلها في البيئة نفسها والتخزين المؤقت الذي يستخدم البيانات عند استدعائها للمرة الأولى. لذلك، يجب تكرار التنفيذ والقياس عدة مرات.

في بعض الأحيان، لا تحدث مشكلات الأداء بسبب تكوين تنسيق التقارير الإلكترونية المستخدم في إعداد التقارير. بدلاً من ذلك، تتم بسبب بواسطة الكود X++ المستخدمة لفتح تكوين تنسيق التقارير الإلكترونية ذلك.

1. في كل من [مركز الإجراءات](#infolog-time) أو [سجل الأحداث](#event-log-time)، انظر إلى وقت تنفيذ التقرير.
2. قم بمقارنة وقت تنفيذ التقرير مع إجمالي وقت التنفيذ في السيناريو.
3. إذا كان وقت تنفيذ التقرير أقل بكثير من إجمالي وقت التنفيذ، فضع في اعتبارك مقدار البيانات التي يعالجها التقرير:

    - إذا كان التقرير يعالج كمية صغيرة من البيانات، قد تتضمن المشكلة وقت تحميل التكوين.
    - إذا كان التقرير يعالج كمية كبيرة من البيانات، قد تتضمن المشكلة المعالجة المسبقة X++. استخدم [محلل التتبع](#analyze-trace-parser-trace) لتحليل هذه الحالة.

    بالنسبة للحالات الأخرى، راجع الأقسام التالية.

4. قم بتشغيل اختبارات متعددة تتضمن كميات مختلفة من البيانات لتحديد كيفية اعتماد وقت التنفيذ على مقدار البيانات.

### <a name="analyze-trace-parser-traces"></a><a name="analyze-trace-parser-trace"></a>تحليل التتبعات باستخدام محلل التتبع

إعداد مثال صغير أو تجميع عدة تتبعات خلال أجزاء عشوائية من إنشاء التقرير.

ثم، في [محلل التتبع](#trace-parser)، قم بإجراء تحليل قياسي من أسفل إلى أعلى، قم أجب على الأسئلة التالية:

- ما أفضل الطرق من حيث استهلاك الوقت؟
- ما الجزء من الوقت الإجمالي الذي تستخدمه هذه الأساليب؟

أجب على الأسئلة نفسها للاستعلامات.

إذا رأيت أن الأساليب مسبوقة ب "التقارير الإلكترونية"، انتقل إلى القسم التالي.

إذا رأيت أن تلك الأساليب أو الاستعلامات نشأت في مجموعة التطبيقات، خذ بعين الاعتبار تحسينات عامة (على سبيل المثال، إنشاء فهارس).

قم بتحليل عدد الاستدعاءات. إذا كان الرقم أعلى بكثير من المتوقع، خذ بعين الاعتبار تخزين المؤقت للعقد المطابقة للتكوين.

### <a name="analyze-database-calls"></a><a name="analyze-database-calls"></a>تحليل استدعاءات قاعدة البيانات

قم بإعداد مثال يحتوي على كمية صغيرة من البيانات، بحيث يمكنك جمع [تتبع التقارير الإلكترونية](#electronic-reporting-traces).

ثم افتح التتبع في مصمم تعيين نموذج التقارير الإلكترونية، وانظر إلى أسفل الصفحة. أجب عن الأسئلة التالية:

- هل هناك أي تكرار للاستعلام؟ إذا كان هناك تكرار، خذ بعين الاعتبار أحد الإصلاحات التالية:

    - [استخدم التخزين المؤقت](#use-caching) إذا كنت تعتقد أن هناك العديد من الاستدعاءات داخل سجل أصل واحد.
    - [استخدم حقل محسوب ذا معلمات مخزن مؤقتًا](#cached-parameterized) إذا كنت تعتقد أن هناك استدعاءات إلى نفس السجل داخل سجلات مختلفة.
    - [استخدم مصدر البيانات **JOIN** ](#use-join-datasource) إذا كان يجب عليك قراءة عدد كبير من السجلات المختلفة من قاعدة البيانات.

- هل يتوافق عدد الاستعلامات والسجلات التي تم إحضارها مع إجمالي كمية البيانات؟ على سبيل المثال، إذا كان المستند يحتوي على 10 أسطر، هل توضح الإحصائيات أن التقرير يستخرج 10 أسطر أو 1000 سطر؟ إذا كان لديك عدد كبير من السجلات التي تم إحضارها، خذ بعين الاعتبار أحد الإصلاحات التالية:

    - [استخدم الوظيفة **FILTER** بدلاً من الوظيفة **WHERE** ](#filter) لمعالجة البيانات على جانب خادم SQL.
    - استخدم التخزين المؤقت لتجنب إحضار نفس البيانات.
    - [استخدم وظائف البيانات المجمعة](#collected-data) لتجنب إحضار نفس البيانات للتلخيص.

### <a name="analyze-perfview-traces"></a>تحليل تتبع PerfView

[PerfView](#perfview) عبارة أداة للمطورين ذوي الخبرة. للحصول على مزيد من المعلومات التفصيلية حول الخطوات التالية، راجع [Wall Clock Time Investigation Basics](https://channel9.msdn.com/Series/PerfView-Tutorial/Tutorial-12-Wall-Clock-Time-Investigation-Basics).

1. اجمع تتبع باستخدام وقت المؤشر.
2. قم فقط بتضمين المكدسات التي تستخدم **runUnattended**، لتصفية المؤشر الذي يحتوي على تنفيذ التكوين فقط. (أضف **runUnattended** إلى مربع إدخال **IncPats** input box.)
3. قم بطي كل وحدات المعالجة المركزية والشبكات والأوقات المحظورة.
4. تحميل [إعدادات التقارير الإلكترونية المسبقة لـ PerfView](https://download.microsoft.com/download/2/d/0/2d037b0f-ffd1-4d65-b64f-fcdf51f2c81f/ER_PerfViewPresets.xml).
5. حدد **التقارير الإلكترونية** \> **إعداد مسبق آخر**.
6. انظر إلى الأسماء:

    - من المحتمل أن تشاهد كود النظام الأساسي الذي يستهلك معظم الوقت.
    - يمكنك الضغط ضغطًا مزدوجًا (أو النقر نقرًا مزدوجًا) والخروج من خلال **المتصل بهم**.

        إذا وجدت الدرجات التي تحتوي على البادئة "ERExpression"، وإذا كانت الوظائف مرتبطة بالمعادلات، يمكنك تخمين اسم الوظيفة استنادًا إلى اسم الفئة، ويمكنك إلقاء نظرة على مستودع التقارير الإلكترونية لعرض السمات.

### <a name="fixes"></a>إصلاحات

- إذا كنت ترى أنه يتم استهلاك معظم وقت وحدة المعالجة المركزية بواسطة الاستعلامات، حاول تقليل عدد الاستعلامات:

    - [راجع تتبع التقارير الإلكترونية](#analyze-database-calls) بالنسبة للاستعلامات المتكررة.
    - راجع عدد السجلات التي يتم إحضارها، وقم بتقييم مقدار البيانات التي يجب إحضارها نظريًا.

- إذا كنت ترى أنه يتم استهلاك معظم وقت وحدة المعالجة المركزية بواسطة الوظائف المستخدمة، حاول العثور على المكان الموجود في التكوين الذي يستهلك معظم الموارد.
- إذا كنت ترى أنه يتم استهلاك معظم الوقت وحدة المعالجة المركزية بواسطة وظائف تجميع البيانات، خذ بعين الاعتبار استبدالها بـ *تجميع SQL حسب* على جانب تعيين النموذج.

### <a name="collecting-data"></a><a name="collecting-data"></a>تجميع البيانات

بناءً على البيئة الخاصة بك، هناك عدة طرق لجمع البيانات المتوفرة:

- احصل على إجمالي وقت التشغيل:

    - من مركز الإجراءات
    - من سجل الأحداث

- ملف تعريف التنفيذ:

    - باستخدام أدوات التقارير الإلكترونية
    - باستخدام محلل التتبع
    - باستخدام PerfView

#### <a name="collecting-data-in-a-production-environment"></a>جمع البيانات في بيئة التشغيل

في بعض الأحيان، يمكن إعادة الإنتاج في بيئة التشغيل فقط. يمكن جمع البيانات بالطرق التالية:

- باستخدام تتبعات [محلل التتبع](../perf-test/trace-trace-tutorial.md)
- باستخدام [تنفيذ التقارير الإلكترونية](trace-execution-er-troubleshoot-perf.md)
- باستخدام إجمالي وقت التنفيذ

#### <a name="collecting-data-in-a-development-environment"></a>جمع البيانات في بيئة التطوير

بالإضافة إلى الأدوات التي يمكن استخدامها في بيئة التشغيل، هناك العديد من الأدوات التي يمكنك استخدامها في بيئة تطوير:

- سجل الأحداث (Microsoft-Dynamics-ElectronicReporting). يمكن أن يمنحك هذا السجل إجمالي وقت التنفيذ.
- أدوات .NET العامة، مثل PerfView.

بالإضافة إلى ذلك، تمنحك بيئة التطوير مرونة أكبر للتجربة. على سبيل المثال، يمكنك إيقاف تشغيل أجزاء التقارير لمعرفة كيفية تأثر وقت التنفيذ.

### <a name="tools"></a><a name="tools"></a>أدوات

#### <a name="execution-time-in-the-action-center"></a><a name="infolog-time"></a>وقت التنفيذ في مركز الإجراءات

يمكن أن تظهر التقارير الإلكترونية وقت تنفيذ التكوين في مركز الإجراء. يعمل هذا الخيار فقط لمستخدم معين وشركة معينة، ولجلسات العمل التفاعلية. لتوفير هذه الميزة، اتبع الخطوات التالية.

1. انتقل إلى **إدارة المؤسسة** \> **التقارير الإلكترونية** \> **التكوينات**.
2. في صفحة **التكوينات**، في جزء الإجراءات، في علامة التبويب **التكوينات**، في مجموعة **الإعدادات المتقدمة**، حدد **معلمات المستخدمين**.
3. في مربع حوار **معلمات المستخدم**، قم بتعيين الخيار **عرض وقت إنشاء الملف** إلى **نعم**.

#### <a name="execution-time-in-the-event-log"></a><a name="event-log-time"></a>وقت التنفيذ في سجل الأحداث

1. افتح عارض أحداث Windows.
2. ضمن **سجلات التطبيقات والخدمات**، افتح **Microsoft-Dynamics-ElectronicReporting/Operational**.
3. ابحث عن أحداث **FormatMapingRun** حيث **EventID=2**، لأن هذه الأحداث تحتوي على معلومات حول الوقت المنقضي.

#### <a name="trace-parser-traces"></a><a name="trace-parser"></a>التتبعات باستخدام محلل التتبع 

نظرًا لأنه يتم تنفيذ التقارير الإلكترونية في X++، فإنه يمكنك استخدام أدوات X++ العامة لتحليل الأداء. لمزيد من المعلومات، راجع [‏‫التقاط تتبعات باستخدام محلل التتبع‬](../perf-test/trace-trace-tutorial.md).

وهناك بعض القيود على هذا الأسلوب. نظرًا لأنه يتم تنفيذ جزء من التقارير الإلكترونية في C#، لن تتوفر جميع التفاصيل. ومع ذلك، يمكنك عرض تفاصيل استخدام البيانات. بالإضافة إلى ذلك، يمكن أن يتجاوز تشغيل التقرير الطويل قيود تخزين التتبع.

#### <a name="er-traces"></a><a name="electronic-reporting-traces"></a>تتبعات التقارير الإلكترونية

يمكن أن تجمع التقارير الإلكترونية تتبعاتها الخاصة، ولديها أدوات مرئيات وتحليل لتلك التتبعات. لمزيد من المعلومات، راجع [تتبع تنفيذ تنسيقات التقارير الإلكترونية لاستكشاف مشكلات الأداء وإصلاحها](trace-execution-er-troubleshoot-perf.md).

#### <a name="perfview"></a><a name="perfview"></a>PerfView

نظرًا لأنه يتم تنفيذ كل من X++ والتقارير الإلكترونية أعلى النظام الأساسي .NET، فإنه يمكنك استخدام أدوات .NET العامة. على سبيل المثال، يمكنك استخدام أداة [PerfView](https://github.com/Microsoft/perfview) مجانية.

يمكنك أيضًا تجميع البيانات من سطر الأوامر. على سبيل المثال، يجمع البرنامج النصي Windows PowerShell التالي وقت التنفيذ حتى يتم إيقاف أي تنفيذ تنسيق على الجهاز.

```powershell
c:\programs\PerfView collect "e:\traces\$(date -format "ddMMyyyy_hhmm").etl" `
    -CircularMB:20000 -ThreadTime `
    -NoNGenRundown `
    -StopOnEtwEvent:Microsoft-Dynamics-ElectronicReporting/FormatMappingRun/Stop
```

وهناك بعض القيود على هذا الأسلوب. يجب أن يكون لديك حق الوصول الإداري إلى الجهاز. بالإضافة إلى ذلك، يجب أن تكون مطور ذو خبرة، لأن هناك منحنى تعلم قوي.

### <a name="making-changes"></a><a name="making-changes"></a>إجراء التغييرات

#### <a name="use-caching"></a><a name="use-caching"></a>استخدام التخزين المؤقت

على الرغم من أن التخزين المؤقت يقلل مقدار الوقت المطلوب لإحضار البيانات مرة أخرى، فإنه يكلف الذاكرة. استخدم التخزين المؤقت في الحالات التي لا يكون فيها مقدار البيانات التي تم إحضارها كبيرًا جدًا. لمزيد من المعلومات ومثال يوضح كيفية استخدام التخزين المؤقت، راجع [تحسين تعيين النموذج استنادًا إلى المعلومات من تتبع التنفيذ](trace-execution-er-troubleshoot-perf.md#improve-the-model-mapping-based-on-information-from-the-execution-trace).

#### <a name="use-a-cached-parameterized-calculated-field"></a><a name="cached-parameterized"></a>استخدام حقل محسوب ذا معلمات ومُخزن مؤقتًا

في بعض الأحيان، يجب البحث عن القيم بشكل متكرر. تتضمن الأمثلة أسماء الحسابات وأرقام الحسابات. للمساعدة في توفير الوقت، يمكنك إنشاء حقل محسوب يحتوي على معلمات في المستوى الأعلى، ثم قم بإضافة الحقل إلى التخزين المؤقت.

نوصي باستخدام هذا الأسلوب فقط عندما يكون حجم البيانات المخزنة مؤقتًا صغيرًا. لمزيد من المعلومات، راجع [تحسين أداء حلول التقارير الإلكترونية عن طريق إضافة مصادر بيانات CALCULATED FIELD ذات المعلمات](er-calculated-field-ds-performance.md).

#### <a name="use-a-join-data-source"></a><a name="use-join-datasource"></a>استخدام مصدر بيانات JOIN

يتيح مصدر البيانات **JOIN** سجلات متصلة متعددة ليتم إحضارها بواسطة استعلام واحد. لا يلزم استخدام استعلام منفصل لإحضار كل سجل متصل. على سبيل المثال، إذا كان لديك 1000 سطر، وكنت تحضر بيانات الصنف لكل سطر حسب العلاقة، سيكون لديك 1001 استعلام (= 1.000 + 1). إذا كنت تستخدم مصدر بيانات **JOIN**، سوف تستخدم استعلام واحد فقط لإحضار البيانات نفسها. للحصول على المزيد من المعلومات، راجع [استخدام مصادر بيانات في تعيينات نموذج التقارير الإلكترونية للحصول على البيانات من جداول التطبيقات المتعددة](er-join-data-sources.md).

#### <a name="use-the-filter-function-instead-of-the-where-function"></a><a name="filter"></a>استخدام الوظيفة FILTER بدلاً من الوظيفة WHERE

تعمل الوظيفة **[FILTER](er-functions-list-filter.md)** على تشغيل الشروط على خادم SQL، في حين أن الوظيفة **WHERE** تعمل على إحضار كافة البيانات من القائمة، سجل واحد في كل مرة وتطبيق الشرط لكل سجل. على سبيل المثال، تريد تحديد سجل واحد من أصل 1000 سجل. إذا كنت تستخدم **WHERE**، فإنه سيتم إحضار كافة السجلات والتي يبلغ عددها 1000 سجلاً. ومع ذلك، إذا كنت تستخدم **FILTER**، سيتم إحضار سجلاً واحدًا فقط. يمكن لـ **FILTER** أيضًا استخدام الفهارس على جانب قاعدة البيانات.

#### <a name="using-collected-data-functions-or-an-accumulated-data-data-source"></a><a name="collected-data"></a>استخدام وظائف البيانات المجمعة أو مصدر بيانات البيانات التراكمية

إذا كان التكوين الخاص بك يحتوي على مكون *تجميع حسب* الذي يلخص البيانات التي تم إحضارها مسبقًا حسب التقرير، فسيعمل المكون على إحضار كافة البيانات مرة أخرى. باستخدام وظائف البيانات المجمعة، فإنك تقوم بتمكين التقارير الإلكترونية من تجميع البيانات أثناء عملية الإحضار الأولى. لمزيد من المعلومات، راجع [التقارير الإلكترونية - تكوين التنسيق لتنفيذ عمليات الجرد والتجميع‬](tasks/er-format-counting-summing-2.md).

#### <a name="rewrite-parts-of-the-configuration-in-x"></a>إعادة كتابة أجزاء من التكوين في X++

تعمل التقارير الإلكترونية على تدعيم طرق استدعاء الجداول والفئات، بما في ذلك الملحقات. ضع في اعتبارك إعادة كتابة أجزاء من تعيين النموذج في X++ للمساعدة في تحسين الأداء.

يمكن أن تستهلك التقارير الإلكترونية البيانات من المصادر التالية:

- الفئات (مصادر بيانات **الكائن** و **الفئة**)
- الجداول (مصادر البيانات **الجدول** و **سجلات الجداول**)

يوفر [ER API](er-apis-app73.md#how-to-access-internal-x-objects-by-using-erobjectsfactory) أيضًا طريقة لإرسال البيانات المحسوب مسبقًا من كود الاستدعاء. تحتوي مجموعة التطبيقات على العديد من الأمثلة على هذا الأسلوب.
