---
title: "تحديد المجموعة المثالية للخصومات المتداخلة"
description: "عندما تتداخل الخصومات، يجب عليك تحديد مجموعة الخصومات المتداخلة التي ستنتج أقل إجمالي حركة أو أعلى إجمالي خصم. عندما يتغير مبلغ الخصم وفقًا لسعر المنتجات المشتراة، كما في حالة خصم البيع بالتجزئة العام \"اشترِ قطعة واحصل على خصم من 1 X بالمئة\" (BOGO)، تصبح هذه العملية مشكلة تحسين توافقي."
author: kfend
manager: AnnBe
ms.date: 06/20/2017
ms.topic: article
ms.prod: 
ms.service: dynamics-365-retail
ms.technology: 
audience: Application User, IT Pro
ms.reviewer: kfend
ms.search.scope: Core, Operations, Retail
ms.custom: 89643
ms.assetid: 09843c9a-3e19-4e4a-a8ce-80650f2095f9
ms.search.region: global
ms.search.industry: Retail
ms.author: kfend
ms.search.validFrom: 2016-05-31
ms.dyn365.ops.version: AX 7.0.1
ms.translationtype: HT
ms.sourcegitcommit: 2771a31b5a4d418a27de0ebe1945d1fed2d8d6d6
ms.openlocfilehash: 4b561503efa24bc4017a4c4360e0355ce39e2f56
ms.contentlocale: ar-sa
ms.lasthandoff: 11/03/2017

---

# <a name="determine-the-optimal-combination-of-overlapping-discounts"></a>تحديد المجموعة المثالية للخصومات المتداخلة

[!include[banner](includes/banner.md)]


عندما تتداخل الخصومات، يجب عليك تحديد مجموعة الخصومات المتداخلة التي ستنتج أقل إجمالي حركة أو أعلى إجمالي خصم. عندما يتغير مبلغ الخصم وفقًا لسعر المنتجات المشتراة، كما في حالة خصم البيع بالتجزئة العام "اشترِ قطعة واحصل على خصم من 1 X بالمئة" (BOGO)، تصبح هذه العملية مشكلة تحسين توافقي.

تنطبق هذه المقالة على Microsoft Dynamics AX 2012 R3 مع مقالة قاعدة المعارف KB 3105973 (تم الإصدار بتاريخ 2 نوفمبر 2015) أو الإصدار اللاحق، وعلى Microsoft Dynamics 365 for Retail. لتحديد مجموعات الخصومات المتداخلة لكي يتم تطبيقها في الوقت المناسب، قمنا بتقديم أسلوب لتطبيق الخصومات المتداخلة.‬ إننا نطلق على هذا الأسلوب الجديد السم **تصنيف القيمة الهامشية**. يتم استخدام تصنيف القيمة الهامشية عندما يتجاوز الوقت المطلوب لتقييم المجموعات الممكنة من الخصومات المتداخلة حدًا قابلاً للتكوين في صفحة **معلمات البيع بالتجزئة**. في أسلوب تصنيف القيمة الهامشية، يتم حساب قيمة لكل خصم متداخل باستخدام قيمة الخصم على المنتجات المشتركة. ويتم عندئذٍ تطبيق الخصومات المتداخلة من أعلى قيمة نسبية إلى أدنى قيمة نسبية. للحصول على مزيد من التفاصيل حول الأسلوب الجديد، راجع مقطع "القيمة الهامشية"، لاحقًا في هذه المقالة. لا يتم استخدام تصنيف القيمة الهامشية عندما لا تتأثر مبالغ الخصم لمنتج ما بمنتج آخر في الحركة. على سبيل المثال، لا يُستخدم هذا الأسلوب لخصمين بسيطين أو لخصم بسيط وخصم على كمية منتج واحد.

## <a name="discount-examples"></a>أمثلة عن الخصم
يمكنك إنشاء عدد غير محدود من خصومات البيع بالتجزئة على مجموعة مشتركة من المنتجات. ومع ذلك، ونظرًا لعدم وجود حد معين، قد تحدث مشكلات في الأداء عند محاولة حساب الخصومات التي يجب استخدامها على مختلف المنتجات. توضح الأمثلة التالية هذه المشكلة بمزيد من التفصيل. في المثال الأول، نبدأ مع منتجين وخصمين متداخلين. بعد ذلك، في المثال الثاني، نعرض كيف تتطور المشكلة مع إضافة المزيد من المنتجات.

### <a name="example-1-two-products-and-two-discounts"></a>المثال الأول: منتجان وخصمان

في هذا المثال، هناك حاجة إلى منتجين للتأهل لكل خصم، ولا يمكن دمج الخصومات. الخصومات في هذا المثال هي خصومات **أفضل سعر**. يتأهل المنتجان للخصمين معًا. فيما يلي معلومات عن الخصمين.
![مجموعة الخصومات المتداخلة 01](./media/overlapping-discount-combo-01.jpg)

بالنسبة إلى أي منتجين، يتوقف أفضل هذين الخصمين على أسعار المنتجين. عندما يكون سعر المنتجين متساويًا أو متساويًا تقريبًا، يكون الخصم 1 أفضل. عندما يكون سعر أحد المنتجين أقل بكثير من سعر المنتج الآخر، يكون الخصم 2 أفضل. إليك القاعدة الرياضية لتقييم هذه الخصمين في مقابل بعضهما البعض: ![مجموعة الخصومات المتداخلة 02](./media/overlapping-discount-combo-02.jpg)

**ملاحظة:** عندما يكون سعر المنتج 1 مساويًا لثلث سعر المنتج 2، يكون الخصمان متساويين.‬ في هذا المثال، تختلف النسبة المئوية للخصم الفعالة للخصم 1 من نسبة مئوية قليلة (عندما تكون أسعار المنتجين متباعدة) إلى أقصى حد من 25 في المائة (عندما يكون سعر المنتجين هو نفسه). تكون النسبة المئوية للخصم الفعالة للخصم 2 ثابتة. فهي دائمًا 20 في المئة. لأن النسبة المئوية للخصم الفعالة للخصم 1 لديها نطاق يمكن أن يكون أكبر من الخصم 2 أو أقل منه، يتوقف أفضل خصم على أسعار المنتجين التي يجب خصمها. في هذا المثال، يتم إكمال الحساب بسرعة، نظرًا لتطبيق خصمين فقط على منتجين اثنين فقط. هناك مجموعتان ممكنتان فقط: تطبيق الخصم 1 أو تطبيق الخصم 2. لا توجد أية تبديلات لحسابها. يتم حساب قيمة كل خصم باستخدام كلا المنتجين، ويستخدم أفضل خصم.

### <a name="example-2-four-products-and-two-discounts"></a>المثال الثاني: أربعة منتجات وخصمان

بعد ذلك، سوف نستخدم المنتجات الأربعة ونفس الخصمين. تتأهل المنتجات الأربعة كلها للخصمين معًا. هناك اثنا عشرة مجموعة ممكنة. في النهاية، سيتم تطبيق خصمين على الحركة في مجموعة واحدة من ثلاث مجموعات: تطبيقان للخصم 1 وتطبيقان للخصم 2 أو تطبيق للخصم 1 وتطبيق للخصم 2. لتوضيح المجموعات الممكنة، سوف نلقي نظرة على مجموعتين مختلفة من أربعة منتجات ذات أسعار مختلفة:

-   المنتجات الأربعة كلها لها السعر نفسه، 15.00 ر.س. في هذه الحالة، تطبيقان للخصم 1 هما أفضل مجموعات خصومات. سنحصل على منتجين بسعر كامل ومنتجين بخصم 50 في المئة. الإجمالي المخصوم للحركة هو 45 ر.س. (15 + 15 + 7.50 + 7.50)، وهو خصم بقيمة 15 ر.س. (25 في المئة) من الإجمالي غير المخصوم لمبلغ 60 ر.س. الخصم 2 هو فقط 12 ر.س. (20 في المئة).
-   هناك منتجان قيمة كل واحد منهما 20 ر.س.، أحدهما قيمته 15 ر.س. والآخر 5 ر.س. في هذه الحالة، أفضل مجموعة خصومات هي تطبيق الخصم 2 وتطبيق الخصم 1. توضح الجداول التالية الخصومات.

لقراءة الجداول، استخدم منتجًا واحدًا من صف ومنتجًا واحدًا من عمود. على سبيل المثال، في جدول الخصم 1، عندما تقوم بدمج المنتجين بقيمة 20 ر.س.، يمكنك الحصول على خصم بقيمة 10 ر.س. في جدول الخصم 2، عندما تقوم بدمج المنتج بقيمة 15 ر.س. والمنتج بقيمة 5 ر.س يمكنك الحصول على خصم بقيمة 4 ر.س.
![مجموعة الخصومات المتداخلة 03](./media/overlapping-discount-combo-03.jpg)

أولاً، سنبحث عن أكبر خصم متوفر من أي منتجين باستخدام أي خصم. يعرض الجدولان مبلغ الخصم لكافة مجموعات المنتجين. تمثل الأجزاء المظللة من الجداول إما الحالات حيث يقترن المنتج بنفسه، والذي لا يمكننا القيام به، أو إقران معكوس لمنتجين ينتجان نفس مبلغ الخصم ويمكن تجاهله. من خلال إلقاء نظرة على الجداول، يمكنك أن تلاحظ أن الخصم 1 للصنفين بقيمة 20 ر.س. هو أكبر خصم متوفر لأي خصم على جميع المنتجات الأربعة. (تم تمييز هذا الخصم باللون الأخضر في الجدول الأول). ويؤدي ذلك إلى ترك فقط المنتج بقيمة 15 ر.س. والمنتج بقيمة 5 ر.س. من خلال إلقاء نظرة من جديد على الجدولين، يمكنك أن تلاحظ أن الخصم 1 يعطي خصمًا بقيمة 2.50 ر.س.، في حين أن الخصم 2 يغطي خصمًا بقيمة 4 ر.س.، لهذين المنتجين. ولذلك، نحن نختار الخصم 2. إجمالي الخصم هو 14 ر.س. لجعل هذه المناقشة سهلة التصور، سنقدم فيما يلي جدولين إضافيين يعرضان النسبة المئوية للخصم الفعالة لجميع المجموعات الممكنة من منتجين للخصمين 1 و2 . لم يتم تضمين سوى نصف قائمة بالمجموعات، نظرًا لعدم أهمية الترتيب الذي تم به وضع المنتجين في الخصم، وذلك بالنسبة إلى هذين الخصمين. تم تمييز الخصم الأكثر فعالية (25 في المئة) باللون الأخضر، وتم تمييز الخصم الأقل فعالية (10 في المئة) باللون الأحمر. 

![مجموعة الخصومات المتداخلة 04](./media/overlapping-discount-combo-04.jpg)

**ملاحظة:** عند وجود اختلاف في الأسعار وعند تنافس منتجين أو أكثر، تقضي أفضل طريقة لضمان الحصول على أفضل مجموعة خصومات بتقييم الخصمين ومقارنتهما.

## <a name="total-possible-combinations"></a>إجمالي المجموعات الممكنة
يتابع هذا القسم المثال من القسم السابق. سوف نضيف المزيد من المنتجات وخصمًا آخر ونعرف عدد المجموعات التي يجب حسابها ومقارنتها. يعرض الجدول التالي عدد مجموعات الخصم الممكنة مع زيادة كمية المنتجات. يبين الجدول ما يحدث عند وجود خصمين متداخلين، كما في المثال السابق، وعند وجود ثلاثة خصومات متداخلة. سرعان ما يتجاوز عدد مجموعات الخصومات الممكنة التي يجب تقييمها ما يستطيع حتى كمبيوتر سريع حسابه ومقارنته بسرعة كافية تكون مقبولة لمعاملات البيع بالتجزئة.

![مجموعة الخصومات المتداخلة 05](./media/overlapping-discount-combo-05.jpg)

عند تطبيق كميات أكبر أو عدد أكبر من الخصومات المتداخلة، ينتقل إجمالي عدد مجموعات الخصومات الممكنة إلى الملايين، ويصبح الوقت المطلوب لتقييم واختيار أفضل المجموعات الممكنة قابلاً للملاحظة بسرعة. تم إجراء بعض التحسينات في محرك سعر البيع بالتجزئة لتقليل العدد الإجمالي للمجموعات التي يجب تقييمها. ومع ذلك، وبما أن عدد الخصومات المتراكبة والكميات في الحركة ليست محدودة، سيكون هناك دائمًا الكثير من المجموعات التي يجب تقييمها كلما كانت هناك خصومات متداخلة. هذه المشكلة هي تلك التي يعالجها أسلوب تصنيف القيمة الهامشية.

## <a name="marginal-value-method"></a>أسلوب القيمة الهامشية
لحل مشكلة العدد المتزايد بشكل سريع للمجموعات التي يجب تقييمها، هناك تحسين موجود يحسب القيمة لكل منتج مشترك لكل خصم على مجموعة المنتجات التي يمكن تطبيق خصمين أو أكثر عليها. نشير إلى هذه القيمة باسم **القيمة الهامشية‬‏‫** للخصم للمنتجات المشتركة. تعتبر القيمة الهامشية المتوسط لكل زيادة في المنتج في مبلغ الخصم الإجمالي عندما يتم تضمين المنتجات المشتركة في كل خصم. يتم حساب القيمة الهامشية بأخذ مبلغ الخصم الإجمالي (DTotal)، وطرح مبلغ الخصم دون المنتجات المشتركة (DMinus\\ Shared)، وقسمة ذلك الخصم على عدد المنتجات المشتركة (ProductsShared). 
![مجموعة الخصومات المتداخلة 06](./media/overlapping-discount-combo-06.jpg)

بعد حساب القيمة الهامشية لكل خصم على مجموعة مشتركة من المنتجات، يتم تطبيق الخصومات على المنتجات المشتركة بالترتيب، بشكل كامل، من أعلى قيمة هامشية إلى أقل قيمة هامشية. بالنسبة إلى هذا الأسلوب، لا تتم مقارنة كل احتمالات الخصومات المتبقية في كل مرة بعد تطبيق مثيل خصم واحد. بدلاً من ذلك، تتم مقارنة الخصومات المتداخلة مرة واحدة ثم يتم تطبيقها بالترتيب. لا يتم إجراء أي مقارنات إضافية. يمكنك تكوين العتبة للتبديل إلى أسلوب القيمة الهامشية على علامة تبويب **الخصم** في صفحة **معلمات البيع بالتجزئة**. يتغير الوقت المقبول لحساب إجمالي الخصم باختلاف قطاعات البيع بالتجزئة. ومع ذلك، يقع هذا الوقت عادة في نطاق يتراوح من عشرات الميلي ثانية إلى ثانية واحدة.




