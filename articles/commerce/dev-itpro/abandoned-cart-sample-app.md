---
title: كشف العربات المهجورة وإرسال الإخطارات للعملاء
description: يصف هذا الموضوع كيفية تخصيص تطبيق نموذج موصل سلة التسوق المتروكة في Microsoft Dynamics 365 Commerce لاكتشاف عربات التسوق المتروكة وإرسال إعلامات بريد إلكتروني تذكير للعملاء.
author: bicyclingfool
ms.date: 02/25/2022
ms.topic: article
audience: Application User, Developer, IT Pro
ms.reviewer: v-chgriffin
ms.search.region: Global
ms.author: stuharg
ms.search.validFrom: 2017-06-20
ms.openlocfilehash: 1db4e988653aa55db2b18fb201edeafc4d16a1bc
ms.sourcegitcommit: ab690bc897699ff8a4c489e749251fe0367050ca
ms.translationtype: HT
ms.contentlocale: ar-SA
ms.lasthandoff: 03/26/2022
ms.locfileid: "8489020"
---
# <a name="detect-abandoned-carts-and-send-notifications-to-customers"></a>كشف العربات المهجورة وإرسال الإخطارات للعملاء

[!include [banner](../includes/banner.md)]

يصف هذا الموضوع كيفية تخصيص تطبيق نموذج موصل سلة التسوق المتروكة في Microsoft Dynamics 365 Commerce لاكتشاف عربات التسوق المتروكة وإرسال إعلامات بريد إلكتروني تذكير للعملاء.

تعد القدرة على استرداد الإيرادات والاحتفاظ بالعملاء من خلال إعلامات سلة التسوق المتروكة قدرة مهمة يدعمها Dynamics 365 Commerce. ومن خلال تخصيص نموذج الموصل الذي يسبق التجارة لسله التسوق، يمكن لبائعي التجزئة الوصول إلى كرتس التسوق علي خادم البيع بالتجزئة الذي لم يتم تعديله خلال الإطار الزمني الذي يحدده البائعون. ويمكن استرداد تلك الكرتسات بعد ذلك، وأوجمينتيد مع بيانات المنتج والعميل، والتي يتم تمريرها إلى موفر تسويق بريد الكتروني لجهة خارجيه والذي يمكنه إنشاء إخطارات البريد الكتروني وإرسال رسائل العملاء اليهم.

واشعار البريد الكتروني لسله التخلي بان العملاء يمكن ان يحتويوا علي المعلومات التالية:

- اسم العميل الأول.
- اسم العميل الأخير.
- عنوان بريد إلكتروني العميل.
- عنوان URL الذي يرجع العميل إلى عربه التسوق الخاصة به.
- عملة الحركة.
- قائمه بالمنتجات الموجودة في سله العملاء. لكل منتج، يتم تضمين المعلومات التالية:

    - اسم العرض الخاص بالمنتج
    - معرف المنتج (يستخدم لتجميع محدد موقع معلومات (URL) لصفحه وصف المنتج)
    - صوره منتج يمكن تغيير حجمها تلقائيا لتتوافق مع احجام اطار البرنامج المختلفة
    - نص بديل لصورة المنتج
    - سعر الوحدة الخاص بالمنتج

## <a name="abandoned-cart-connector-sample"></a>نموذج موصل السلة الذي تم التخلي عنه

نموذج الموصل الذي توفره Microsoft من خلال مجموعه تطوير برامج البيع بالتجزئة (SDK) يمكن استرداد معلومات العربة التي تم التخلي عنها وإرسالها إلى موفر تسويق البريد الكتروني للجهة الخارجية. يتعامل هذا الموصل مع الاتصالات مع خادم البيع بالتجزئة ويستخدم مخزن مفتاح Azure للامان ويقوم بمعالجه عمليه استرداد السلة لنافذه زمنيه محدده واسترداد بيانات الأمر والمنتج. كما يوفر نموذج لتطبيق تكامل خاص بموفر تسويق البريد الكتروني للجهة الخارجية. يتم إنشاء الموصل للتواصل مع [Emarsys](https://emarsys.com) بشكل جاهز. ومع ذلك، يمكن تخصيصه بسهولة للتكامل مع حلول أخرى، مثل Constant Contact وMailchimp وSendGrid.

يبين الرسم التوضيحي التالي مكونات تطبيق نموذج موصل السلة الذي تم التخلي عنه.

![مكونات نموذج تطبيق نموذج موصل السلة الذي تم التخلي عنه](media/AbandonedCartConnector.png)

> [!IMPORTANT]
> تتطلب بعض المناطق ان يتمكن العملاء من الانسحاب من الحصول علي بيانات سله التسوق التي تم تمريرها إلى موفر تسويق عبر البريد الكتروني، أو طلب أزاله البيانات الخاصة بهم. ومع ذلك، لا تقدم Microsoft هذه الخيارات للعملاء. ولذلك، إذا كنت تخطط للقيام باعمال تجاريه في المناطق التي النهجها، فيجب توفير البنية الاساسيه والتخصيصات المطلوبة لتتبع تفضيلات العملاء، واستنادا اليها، منع تمرير بيانات العميل إلى النظام الأساسي للبريد الكتروني. يجب أيضا تحديد عمليه لحذف بيانات العملاء من موفر التسويق عبر البريد الكتروني في طلب العميل.

## <a name="obtain-the-code-sample"></a>الحصول على نموذج التعليمات البرمجية

تم تضمين نموذج رابط العربة الذي تم التخلي عنه في Retail SDK بالإصدار 10.0.16. يمكن العثور علي التعليمات البرمجية ضمن **\\RetailSDK\\Code\\SampleExtensions\\RetailServer\\Extensions.AbandonedCartSample**. لمزيد من المعلومات حول Retail SDK ومكان الحصول عليها، راجع [بنية مجموعة تطوير برنامج Retail](retail-sdk/retail-sdk-overview.md).

> [!NOTE]
> علي الرغم من انه تم توفير نموذج الرمز لأول مره في الإصدار 10.0.16، فانه متوافق مع الإصدار 10.0.13 والبناءات اللاحقة لخادم البيع بالتجزئة.

## <a name="prerequisites-and-dependencies"></a>المتطلبات الاساسيه و التبعيات

قبل ان تتمكن من نشر الكود الخاص بنموذج موصل السلة الذي تم التخلي عنه وتكوينه، يجب استيفاء المتطلبات الاساسيه التالية.

### <a name="access-to-commerce-resources"></a>الوصول إلى الموارد التجارية

لتكوين تطبيق موصل السلة الذي تم التخلي عنه ونشره، يجب ان يكون لديك حق الوصول إلى موارد التجارة التالية:

- وصول المسؤول إلى مركز التجارة الخاص ببيئتك
- الوصول إلى مشروع Microsoft Dynamics ‏Lifecycle Services ‏(LCS) لبيئتك

### <a name="azure-cosmos-db"></a>Azure Cosmos DB

يستخدم تطبيق موصل العربة المتروك Azure Cosmos DB لتتبع المعرفات والطوابع الزمنيه للعربات التي تم استردادها مسبقا. يمكنك استخدام Azure Cosmos DB لاستمرار هذه البيانات، أو يمكنك تخصيص نموذج التعليمات البرمجية للتكامل مع خيار تخزين بيانات آخر. لمزيد من المعلومات حول Azure Cosmos DB، راجع [مرحبا بك في Azure Cosmos DB](/azure/cosmos-db/introduction).

إذا كنت تستخدم Azure Cosmos DB، فيجب تلبية المتطلبات الأساسية التالية قبل أن تتمكن من تشغيل العينة:

- يجب أن يكون لديك حساب Azure Cosmos DB نشط. إذا لم يكن لديك حساب، راجع [إنشاء حساب قاعدة بيانات](/azure/cosmos-db/create-sql-api-dotnet#create-a-database-account).
- يجب عليك استرداد قيم **URI** و **المفتاح الأساسي** (أو **المفتاح الثانوي**) من لوحة **المفاتيح** في حساب Azure Cosmos DB في مدخل Azure. لمزيد من المعلومات حول كيفيه استرداد معلومات النقطة النهائية ومعلومات المفتاح لحسابك في Azure Cosmos DB، راجع [عرض مفاتيح الوصول وكلمات المرور ونسخها وإعادة إنشاؤها](/azure/cosmos-db/manage-account#keys).

### <a name="azure-key-vault"></a>Azure Key Vault

يستخدم تطبيق موصل العربة المتروك المخزن الرئيسي لتخزين أسماء واسرار المكونات المختلفة التي تتطلب وصول أمن.

لإعداد المخزن الرئيسي، اتبع هذه الخطوات.

1. اتبع الإرشادات الموجودة في [إدارة المخزن الرئيسي في مركز مكدس Azure باستخدام المدخل](/azure-stack/user/azure-stack-key-vault-manage-portal?view=azs-2002&preserve-view=true).
2. إنشاء أسرار للمعلومات التالية:

    - واجهة برمجة تطبيقات Emarsys (API)، اسم المستخدم وسرية API
    - معرّف طلب سلة التسوق المتروكة والسر

يستخدم نموذج التعليمات البرمجية لموصل سلة التسوق المتروكة بيانات اعتماد Azure الافتراضية للوصول إلى المخزن الرئيسي. يجب توفير أذونات **القوائم** و **القراءة** للهوية التي تخطط لاستخدامها للوصول إلى المخزن الرئيسي.

لمزيد من المعلومات حول بيانات اعتماد Azure الافتراضية، راجع [فئة DefaultAzureCredential](/dotnet/api/azure.identity.defaultazurecredential?view=azure-dotnet&preserve-view=true).

## <a name="create-an-abandoned-cart-connector-sample-app-application-id-for-the-azure-ad-tenant"></a>أنشئ نموذج معرف تطبيق موصل عربة متروك لمستأجر Azure AD

يجب عليك إنشاء نموذج معرف تطبيق موصل عربة متروك لمستأجر Azure Active Directory ‏(AD). للحصول على معلومات حول كيفية إنشاء معرف التطبيق، راجع [كيفية: استخدم المدخل لإنشاء تطبيق Azure AD ومدير خدمة يمكنه الوصول إلى الموارد](/azure/active-directory/develop/howto-create-service-principal-portal).

## <a name="add-the-abandoned-cart-connector-sample-app-application-id-to-the-allow-list-for-the-retail-server-api"></a>أضف نموذج معرف تطبيق موصل عربة التسوق المتروكة إلى قائمة السماح لـ Retail Server API

بعد ذلك، يجب إضافة معرف تطبيق نموذج موصل عربة التسوق المهجور إلى قائمة السماح لـ Retail Server API. للحصول على معلومات حول كيفية إضافة معرف تطبيق إلى قائمة السماح في Azure، راجع [دعم مصادقة الخدمة إلى الخدمة في خادم البيع بالتجزئة](https://community.dynamics.com/ax/b/axforretail/posts/support-for-service-to-service-authentication-in-retail-server).

## <a name="configure-the-abandoned-cart-connector-sample-app"></a>تكوين تطبيق نموذج موصل السلة الذي تم التخلي عنه

لتكوين تطبيق نموذج موصل سلة التسوق الذي تم التخلي عنه، قم بتعديل ملف تكوين **appSettings.json** الموجود في جذر دليل **AbandonedCartDetectionSample**. تصف الجداول التالية خصائص ملف التكوين.

### <a name="keyvaultoptions"></a>KeyVaultOptions

| الخاصية    | ‏‏الوصف‬ |
| ----------- | ----------- |
| KeyVaultURI | اسم نظام اسم المجال (DNS) الخاص بالمخزن الرئيسي الذي تستخدمه في مدخل Azure. |

### <a name="retailserverclientoptions"></a>RetailServerClientOptions

| الخاصية                                      | ‏‏الوصف‬ |
| --------------------------------------------- | ----------- |
| TenantId                                      | معرف مستأجر Azure AD لمستأجر Azure الخاص بك. |
| RetailServerAudienceId                        | معرف جمهور Retail Server. يمكنك ترك القيمة الافتراضية. |
| AppIdKeyVaultSecretName                       | اسم السر الذي أنشأته لنموذج معرف تطبيق التطبيق لموصل سلة التسوق المتروكة. |
| AppSecretKeyVaultSecretName                   | اسم السر الذي يخزن سر التطبيق لمعرّف تطبيق نموذج موصل سلة التسوق المتروكة. |
| RetailServerUrl                               | عنوان URL الخاص بمثيل Retail Server. يمكنك العثور علي هذه القيمة في LCS. |
| OperatingUnitNumber                           | رقم وحدة التشغيل (OUN). يمكنك العثور على هذه القيمة في Commerce headquarters. |
| IncludeAbandonedCartsModifiedSinceLastMinutes | بداية النافذة الزمنية للعربات المتروكة التي تريد استردادها. يتم التعبير عن القيمة بعدد من الدقائق قبل الوقت الحالي. على سبيل المثال، قم بتعيين هذه الخاصية إلى **120** لاسترداد جميع عربات التسوق التي تم تعديلها آخر مرة بين 120 دقيقة مضت ونهاية الإطار الزمني الذي تم تحديده بواسطة خاصية **ExcludeAbandonedCartsModifiedSinceLastMinutes**. |
| ExcludeAbandonedCartsModifiedSinceLastMinutes | نهاية النافذة الزمنية للعربات المتروكة التي تريد استردادها. يتم التعبير عن القيمة بعدد من الدقائق قبل الوقت الحالي. على سبيل المثال، في حالة تعيين **IncludeAbandonedCartsModifiedSinceLastMinutes** إلى **120**، قم بتعيين هذه الخاصية إلى **30** لاسترداد جميع عربات التسوق التي تم تعديلها منذ ما بين 120 دقيقة و30 دقيقة مضت. في الممارسة العملية، تحدد هذه الخاصية مقدار الوقت الذي تريد انتظاره قبل الإعلان عن التخلي عن عربة التسوق. |
| ReturnToCartUrl                               | عنوان URL لعربة التسوق على موقع التجارة الإلكترونية الخاص بك، بالتنسيق المستخدم في ملف **app.config**. |

### <a name="azurecosmosoptions"></a>AzureCosmosOptions

يتم تخزين حالة مهمة استرداد عربة التسوق المتروكة ومعرفات سلة التسوق والطوابع الزمنية المعدلة في Azure Cosmos DB. بشكل افتراضي، تشير الإعدادات في ملف التكوين إلى مثيل المحاكي المحلي لـ Azure Cosmos DB. عند نشر الموصل في الإنتاج، يجب عليك تحديث هذه الإعدادات بحيث تشير إلى مثيل Azure Cosmos DB في اشتراك Azure الخاص بك. للاختبار المحلي أو داخل ‏‫بيئة الاختبار المعزول، يمكنك استخدام [محاكي Azure Cosmos DB.](/azure/cosmos-db/local-emulator).

| الخاصية    | ‏‏الوصف‬ |
| ----------- | ----------- |
| EndPointUri | عنوان URI لنقطة النهاية التي يتم توفيرها بواسطة Azure أو المحاكي. |
| PrimaryKey  | المفتاح الأساسي الذي يتم توفيره بواسطة Azure أو المحاكي. |
| DatabaseId  | معرف قاعدة البيانات. يمكنك ترك القيمة الافتراضية أو تقديم القيمة الخاصة بك. |
| ContainerId | مُعرِّف الحاوية. يمكنك ترك القيمة الافتراضية أو تقديم القيمة الخاصة بك. |

### <a name="emarsysclientoptions"></a>EmarsysClientOptions

> [!NOTE]
> إذا كنت تتكامل مع مزود تسويق عبر البريد الإلكتروني بخلاف Emarsys، فيجب عليك تمديد واجهة **IEmailProvider** بالشكل المناسب للتواصل مع هذا المزود.

| الخاصية                      | ‏‏الوصف‬ |
| ----------------------------- | ----------- |
| ApiUrl                        | `https://api.emarsys.net/api/v2/event/{0}/trigger` |
| ExternalEventId               | معرّف سجل الحدث الخارجي الذي تم إنشاؤه في Emarsys. يمكنك العثور على القيمة ضمن **إعدادات المشغل** في الحملة التي أنشأتها لإرسال إشعارات البريد الإلكتروني لسلة التسوق المهجورة. |
| ApiUserNameKeyVaultSecretName | اسم المفتاح حيث يتم تخزين اسم مستخدم Emarsys API. |
| ApiSecretKeyVaultSecretName   | اسم المفتاح حيث يتم تخزين سر Emarsys API. |
| EmarsysContactKeyId           | معرّف عمود البريد الإلكتروني في قاعدة بيانات جهات اتصال Emarsys. القيمة الافتراضية هي **3** ويجب ألا يتم تغييرها. |

### <a name="mediaoptions"></a>MediaOptions

إذا كنت تستخدم إمكانات التجارة الإلكترونية في Commerce، فيمكنك استخدام إدارة الأصول الرقمية التجارية لاسترداد صور المنتج. لمزيد من المعلومات حول إمكانات أداة تغيير حجم الصورة في إدارة الأصول الرقمية، راجع[تكوين منفذ عرض ImageSettings](../e-commerce-extensibility/image-component.md#imagesettings-viewport-configuration).

| الخاصية                             | ‏‏الوصف‬ |
| ------------------------------------ | ----------- |
| ImageServerUrl                       | عنوان URL الجذر لمدير الأصول الرقمية لموقعك. يمكنك العثور على القيمة في مفتاح خاصية **عنوان URL الأساسي لخادم الوسائط‬‏** في **Retail وCommerce \> إعداد القناة \> ملفات تعريف القنوات** في Commerce headquarters. |
| ImageViewPorts                       | عقدة الحاوية لتكوينات منفذ العرض الفردية. |
| ImageViewPorts/viewport              | تعريف منفذ العرض. استخدم هذه الخاصية لتحديد نطاقات العرض لمنفذ العرض بالبكسل. للحصول علي مثال يوضح كيفيه استخدام هذه الخاصية، راجع ملف تكوين **appSettings.json**. |
| ImageViewPorts/imageWidth            | عرض الصورة الخاصة بمنفذ العرض بالبكسل. |
| imageViewPorts/imageHeight           | ارتفاع الصورة الخاصة بمنفذ العرض بالبكسل. |
| imageViewPorts/useForDefaultImageTag | قيمة **صواب**/**خطأ** يشير إلى ما إذا كان يجب استخدام أبعاد الصورة التي تم تحديدها بواسطة منفذ العرض إذا كانت علامة `<picture>` HTML غير مدعومة لمستعرض الويب أو عميل بريد إلكتروني. |

[!INCLUDE[footer-include](../../includes/footer-banner.md)]
