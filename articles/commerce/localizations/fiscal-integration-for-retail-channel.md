---
title: نظرة عامة على التكامل المالي لقنوات Commerce
description: يوفر هذا الموضوع نظرة عامة حول قدرات التكامل المالي المتوفرة في Dynamics 365 Commerce.
author: josaw
ms.date: 02/01/2019
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: RetailFunctionalityProfile, RetailFormLayout, RetailParameters
audience: Application User
ms.reviewer: josaw
ms.custom: intro-internal
ms.search.region: Global
ms.search.industry: Retail
ms.author: epopov
ms.search.validFrom: 2019-1-16
ms.dyn365.ops.version: 10
ms.openlocfilehash: 6545f3ee488cdd98530839f546ca2e6a434194437dfa98712a1a6ac3407afdbf
ms.sourcegitcommit: 42fe9790ddf0bdad911544deaa82123a396712fb
ms.translationtype: HT
ms.contentlocale: ar-SA
ms.lasthandoff: 08/05/2021
ms.locfileid: "6733931"
---
# <a name="overview-of-fiscal-integration-for-commerce-channels"></a>نظرة عامة على التكامل المالي لقنوات Commerce

[!include [banner](../includes/banner.md)]

## <a name="introduction"></a>مقدمة

هذا الموضوع هو نظرة عامة حول قدرات التكامل المالي المتوفرة في Dynamics 365 Commerce. يتضمن التكامل المالي التكامل مع أجهزة وخدمات مالية مختلفة تمكّن التسجيل المالي للمبيعات وفقًا للقوانين المالية المحلية التي تهدف إلى منع الاحتيال الضريبي في مجال البيع بالتجزئة. فيما يلي بعض السيناريوهات النموذجية التي يمكن تغطيتها باستخدام التكامل المالي:

- تسجيل مبيعات على جهاز مالي متصل بنقطة بيع (POS)، مثل الطابعة المالية وطباعة إيصال مالي للعميل.
- إرسال معلومات المبيعات والمرتجعات‬ المستكملة في Retail POS إلى خدمة ويب خارجية تشغلها هيئة الضرائب، بطريقة آمنة.
- المساعدة في ضمان عدم قابلية تحول بيانات حركة مبيعات من خلال التواقيع الرقمية.

تعتبر وظيفة التكامل المالي إطار عمل يوفر حلاً مشتركًا لمزيد من التطوير والتخصيص للتكامل بين Retail POS والأجهزة والخدمات المالية. وتتضمن الوظيفة أيضًا نماذج التكامل المالي التي تدعم السيناريوهات الأساسية لبلدان أو مناطق محددة، والتي تصلح لخدمات أو أجهزة مالية محددة. يتكون نموذج التكامل المالي من عدة ملحقات لمكونات Commerce وهو مضمن في مجموعة تطوير البرنامج (SDK). للحصول على مزيد من المعلومات حول عينات التكامل المالي، راجع [نظرة عامة على عينات التكامل المالي في Retail SDK](#fiscal-integration-samples-in-the-retail-sdk). للحصول على مزيد من المعلومات حول كيفية تثبيت واستخدام Retail SDK، راجع [بنية مجموعة تطوير برنامج Retail](../dev-itpro/retail-sdk/retail-sdk-overview.md).

لدعم السيناريوهات الأخرى التي لا يدعمها نموذج التكامل المالي، أو لدمج Retail POS مع أجهزة أو خدمات مالية أخرى، أو لتغطية المتطلبات الخاصة بالبلدان أو المناطق الأخرى، يجب إما توسيع تكامل مالي موجود أو إنشاء نموذج جديد باستخدام نموذج موجود كمثال.

## <a name="fiscal-registration-process-and-fiscal-integration-samples-for-fiscal-devices"></a>عملية التسجيل المالي ونماذج التكامل المالي للأجهزة المالية

بإمكان عملية التسجيل المالي في Retail POS أن تتكون من خطوة واحدة أو أكثر. تشتمل كل خطوة على التسجيل المالي لأحداث أو حركات معينة في جهاز مالي واحد أو خدمة مالية واحدة. تشارك مكونات الحل التالية في التسجيل المالي في جهاز مالي متصل بمحطة أجهزة:

- **ملحق Commerce runtime (CRT)** – يقوم هذا المكون بسلسة بيانات حدث/حركة بالتنسيق الذي يُستخدم أيضًا للتفاعل مع الجهاز المالي، ويحلل الاستجابات من الجهاز المالي ويخزن الاستجابات في قاعدة بيانات القناة. ويحدد الملحق أيضًا الحركات والأحداث المعينة التي يجب تسجيلها. يشار إلى هذا المكون في أغلب الأحيان بالاسم *موفر المستندات المالية*.
- **ملحق محطة الأجهزة** - يقوم هذا المكون بتهيئة الاتصال بالجهاز المالي، ويرسل الطلبات ويوجه الأوامر إلى الجهاز المالي استنادًا إلى بيانات الحركة/الحدث المستخرجة من المستند المالي، ويتلقى الاستجابات من الجهاز المالي. يشار إلى هذا المكون في أغلب الأحيان بالاسم *موصل مالي*.

يحتوي نموذج التكامل المالي لجهاز مالي على ملحقات وقت التشغيل التجاري (CRT) ومحطة الأجهزة لموفر مستندات مالية وموصل مالي، على التوالي. ويحتوي أيضًا على تكوينات المكونات التالية:

- **تكوين موفر المستندات المالية** - يحدد هذا التكوين أسلوب إخراج وتنسيق للمستندات المالية. ويحتوي أيضًا على تعيين بيانات للضرائب وطرق الدفع، لجعل البيانات من Retail POS متوافقة مع القيم المعرّفة بشكل مسبق في البرنامج الثابت للجهاز المالي.
- **تكوين الموصل المالي** - يحدد هذا التكوين الاتصال الفعلي بالجهاز المالي المحدد.

يتم تعريف عملية تسجيل مالي لسجل نقطة بيع معين بواسطة إعداد مناظر في ملف تعريف وظائف نقطة البيع. لمزيد من التفاصيل حول كيفية تكوين عملية تسجيل مالي، وتحميل موفر المستندات المالية وتكوينات الموصل المالي، وتغيير معلماتها، راجع [إعداد عملية تسجيل مالي](setting-up-fiscal-integration-for-retail-channel.md#set-up-a-fiscal-registration-process).

يوضح المثال التالي تدفق تنفيذ تسجيل مالي نموذجي لجهاز مالي. يبدأ التدفق بحدث في نقطة البيع (على سبيل المثال، إنجاز حركة مبيعات) وينفذ تسلسل الخطوات التالية:

1. تطلب نقطة البيع مستندًا ماليًا من CRT.
2. يحدد CRT ما إذا كان الحدث الحالي يحتاج إلى تسجيل مالي.
3. استنادًا إلى إعدادات عملية التسجيل المالي، يحدد CRT موصلاً ماليًا وموفر المستندات المالية المناظر لاستخدامه في التسجيل المالي.
4. يشغل CRT موفر المستندات المالية المسؤول عن إنشاء مستند مالي (على سبيل المثال، مستند XML) يمثل الحدث أو الحركة.
5. ترسل نقطة البيع المستند المالي الذي يقوم CRT بإعداده إلى محطة أجهزة.
6. تشغّل محطة الأجهزة الموصل المالي الذي يعالج المستند المالي وتبلغ عنه الجهاز المالي أو الخدمة المالية.
7. تحلل نقطة البيع استجابة الجهاز المالي أو الخدمة المالية لتحديد ما إذا كان التسجيل المالي قد تم بنجاح.
8. يحفظ CRT الاستجابة في قناة قاعدة البيانات.

![مخطط الحل.](media/emea-fiscal-integration-solution.png "مخطط الحل")

## <a name="error-handling"></a>معالجة الأخطاء

يوفر إطار عمل التكامل المالي الخيارات التالية للتعامل مع حالات الفشل أثناء التسجيل المالي:

- **إعادة المحاولة** - بإمكان العاملين استخدام هذا الخيار عندما يكون حل الفشل بسرعة ممكنًا، ويمكن إعادة تشغيل التسجيل المالي. على سبيل المثال، يمكن استخدام هذا الخيار عندما لا يكون الجهاز المالي متصلاً، ونفاد الورق من طابعة الضرائب المحصلة، أو هناك ازدحام ورق في طابعة الضرائب المحصلة.
- **إلغاء** - يسمح هذا الخيار للعاملين بتأجيل التسجيل المالي للحدث الحالي أو الحركة الحالية في حال فشله. بعد تأجيل التسجيل، بإمكان العامل متابعة العمل في نقطة البيع وإكمال أي عملية لا تحتاج إلى تسجيل مالي. عند وقوع أي حدث يحتاج إلى تسجيل مالي في نقطة البيع (على سبيل المثال، فتح حركة جديدة)، يظهر مربع حوار معالجة الأخطاء بشكل تلقائي لإبلاغ العامل أن الحركة السابقة لم تسجل بشكل صحيح ولتوفير خيارات معالجة الأخطاء.
- **تخطي** - بإمكان العاملين استخدام هذا الخيار عندما يكون تجاهل التسجيل المالي ممكنًا في ظل شروط معينة ويمكن متابعة العمليات العادية في نقطة البيع. على سبيل المثال، يمكن استخدام هذا الخيار عندما يمكن تسجيل حركة مبيعات فشلت عملية التسجيل المالي لها المالي في دفتر يومية ورقي خاص.
- **وضع علامة كمسجل** - بإمكان العاملين استخدام هذا الخيار إذا تم تسجيل الحركة فعليًا في الجهاز المالي (على سبيل المثال، تمت طباعة أيصال مالي)، ولكن حدث فشل أثناء حفظ الاستجابة المالية إلى قاعدة بيانات القناة.

> [!NOTE]
> يجب تنشيط الخيارين **تخطي** و **ووضع علامة كمسجل** في عملية التسجيل المالي قبل استخدامهما. بالإضافة إلى ذلك، يجب أن يُمنح العاملون أذونات مطابقة.

يسمح الخياران **تخطي** و **وضع علامة كمسجل** لأكواد المعلومات بتسجيل معلومات معينة حول الفشل، مثل سبب الفشل أو تبرير تخطي التسجيل المالي أو وضع علامة على الحركة كمسجلة. للحصول على مزيد من التفاصيل حول كيفية إعداد المعلمات لمعالجة الأخطاء، راجع [تعيين إعدادات معالجة الأخطاء](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).

### <a name="optional-fiscal-registration"></a>التسجيل المالي الاختياري

قد يكون التسجيل المالي إلزاميًا لبعض العمليات ولكن اختياريًا للبعض الآخر. على سبيل المثال، قد يكون التسجيل المالي لعمليات البيع والإرجاع العادية إلزاميًا، ولكن التسجيل المالي للعمليات المرتبطة بإيداعات العملاء قد يكون اختياريًا. وفي هذه الحالة، من المفترض أن يؤدي عدم إتمام عملية التسجيل المالي لعملية مبيعات إلى منع عمليات مبيعات إضافية، ولكن عدم إتمام عملية التسجيل المالي لإيداع العميل لا يؤدي إلى حظر عمليات مبيعات إضافية. للتمييز بين العمليات الإلزامية والاختيارية، فإننا ننصح بضرورة معالجتها من خلال موفري مستندات مختلفين، وبأن تقوم بإعداد خطوات منفصلة في عملية التسجيل المالي لهؤلاء الموفرين. يجب تمكين المعلمة **المتابعة مع وجود الخطأ‬** لأي خطوة تتعلق بالتسجيل المالي الاختياري. للحصول على مزيد من التفاصيل حول كيفية إعداد المعلمات لمعالجة الأخطاء، راجع [تعيين إعدادات معالجة الأخطاء](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).

### <a name="manually-running-fiscal-registration"></a>تشغيل التسجيل المالي يدويًا

إذا تم تأجيل التسجيل المالي لحركة أو حدث بعد حدوث فشل (على سبيل المثال، إذا حدد المشغل **إلغاء** في مربع حوار معالجة الأخطاء)، فيمكنك إعادة تشغيل التسجيل المالي يدويًا عن طريق استدعاء عملية مناظرة. للحصول على مزيد من التفاصيل، راجع [تمكين التنفيذ اليدوي للتسجيل المالي المؤجل](setting-up-fiscal-integration-for-retail-channel.md#enable-manual-execution-of-postponed-fiscal-registration).

### <a name="fiscal-registration-health-check"></a>فحص صحة التسجيل المالي

يتحقق إجراء فحص صحة عمليات التسجيل المالي من توفر الجهاز المالي أو الخدمة المالية عند وقوع أحداث معينة. إذا تعذر إكمال التسجيل المالي في الوقت الحالي، فسيتم إعلام المشغل بشكل مسبق.

تقوم نقطة البيع بتشغيل فحص الصحة عند وقوع الأحداث التالية:

- فتح حركة جديدة.
- إعادة استدعاء حركة معلقة.
- إنجاز عملية مبيعات أو إرجاع.

إذا فشل فحص الصحة، تُظهر نقطة البيع مربع حوار فحص الصحة. يوفر مربع الحوار هذا الأزرار التالية:

- **موافق** – يتيح هذا الزر للمشغل تجاهل خطأ فحص الصحة ومتابعة معالجة العملية. بإمكان المشغلين تحديد هذا الزر فقط إذا تم تمكين الإذن **السماح بتخطي خطأ فحص الصحة** لهم.
- **إلغاء** – إذا حدد المشغل هذا الزر، تلغي نقطة البيع الإجراء الأخير (على سبيل المثال، لا يُضاف أحد العناصر إلى حركة جديدة).

> [!NOTE]
> يتم تشغيل فحص الصحة فقط إذا كانت العملية الحالية تحتاج إلى تسجيل مالي، وإذا تم تعطيل المعلمة **المتابعة مع وجود الخطأ‬** للخطوة الحالية من عملية التسجيل المالي. للحصول على مزيد من التفاصيل، راجع [تعيين إعدادات معالجة الأخطاء](setting-up-fiscal-integration-for-retail-channel.md#set-error-handling-settings).

## <a name="storing-fiscal-response-in-fiscal-transaction"></a>تخزين الاستجابة المالية في الحركة المالية

عند نجاح التسجيل المالي الحركة أو حدث، يتم إنشاء حركة مالية في قاعدة بيانات القناة ويتم ربطها بالحركة أو الحدث الأصلي. وبشكل مماثل، إذا تم تحديد الخيار **تخطي** أو **وضع علامة كمسجل** لتسجيل مالي فاشل، يتم تخزين هذه المعلومات في حركة مالية. تتضمن الحركة المالية الاستجابة المالية للجهاز المالي أو الخدمة المالية. وإذا كانت عملية التسجيل المالي مكونة من عدة خطوات، يتم إنشاء حركة مالية لكل خطوة من العملية التي أدت إلى تسجيل ناجح أو فاشل.

يتم تحويل الحركات المالية إلى المراكز الرئيسية بواسطة *وظيفة P* مع الحركات. على علامة التبويب السريعة **الحركات المالية** في صفحة **حركات المتجر**، يمكنك عرض الحركات المالية المرتبطة بحركات.

تخزن الحركة المالية التفاصيل التالية:

- تفاصيل عملية التسجيل المالية (العملية، ومجموعة الموصلات، وموصل، وغير ذلك). وهي تخزن أيضًا الرقم التسلسلي للجهاز المالي في الحقل **رقم السجل**، إذا تم تضمين هذه المعلومات في الاستجابة المالية.
- حالة التسجيل المالي: **مكتمل** لنجاح التسجيل، أو **تخطي** إذا حدد العامل الخيار **تخطي** لعملية تسجيل فاشلة أو **وضع علامة كمسجل** إذا حدد العامل الخيار  **وضع علامة كمسجل‏‎**.
- حركات أكواد المعلومات‬ المرتبطة بحركة مالية محددة. لعرض حركات أكواد المعلومات، في علامة التبويب السريعة **الحركات المالية**، حدد حركة مالية بالحالة **تخطي** أو **وضع علامة كمسجل**، ثم حدد **حركات أكواد المعلومات**.

## <a name="fiscal-texts-for-discounts"></a>النصوص المالية للخصومات

تضع بعض البلدان أو المناطق شروطًا معينة حول النصوص الإضافية التي يجب طباعتها على الإيصالات المالية عند تطبيق أنواع مختلفة من الخصومات. تسمح لك وظيفة التكامل المالي بإعداد نص خاص للخصم يُطبع بعد سطر خصم على إيصال مالي. وبالنسبة إلى الخصومات اليدوية، يمكنك تكوين نص مالي لكود المعلومات المحدد في كود المعلومات **خصم المنتج** في ملف تعريف وظائف نقطة البيع. للحصول على مزيد من التفاصيل حول كيفية إعداد النصوص المالية للخصومات، راجع [إعداد النصوص المالية للخصومات](setting-up-fiscal-integration-for-retail-channel.md#set-up-fiscal-texts-for-discounts).

## <a name="printing-fiscal-x-and-fiscal-z-reports"></a>طباعة التقارير المالية X وZ

تدعم وظيفة التكامل المالي إنشاء كشوفات نهاية اليوم الخاصة بالجهاز أو الخدمة المالية المتكاملة:

- يجب إضافة أزرار جديدة تقوم بتشغيل عمليات مناظرة إلى تخطيط شاشة نقطة البيع. للحصول على مزيد من التفاصيل، راجع [إعداد التقارير المالية X/Z من نقطة البيع](setting-up-fiscal-integration-for-retail-channel.md#set-up-fiscal-xz-reports-from-the-pos).
- في نموذج التكامل المالي، يجب أن تتطابق هذه العمليات مع العمليات المناظر للجهاز المالي.

## <a name="fiscal-integration-samples-in-the-retail-sdk"></a>نماذج التكامل المالي في Retail SDK

في الوقت الحالي، تتوفر عينات التكامل المالي التالية في Retail SDK:

- [عينة تكامل طابعة الضرائب المحصلة لإيطاليا](emea-ita-fpi-sample.md)
- [عينة تكامل طابعة الضرائب المحصلة لبولندا](emea-pol-fpi-sample.md)
- [عينة تكامل خدمة التسجيل المالي للنمسا](emea-aut-fi-sample.md)
- [عينة تكامل خدمة التسجيل المالي لجمهورية التشيك‬](emea-cze-fi-sample.md)
- [نموذج تكامل وحدة التحكم للسويد](./emea-swe-fi-sample.md)
- [عينة تكامل خدمة التسجيل المالي لألمانيا](./emea-deu-fi-sample.md)

تتوفر أيضًا وظيفة التكامل المالي التالية في Retail SDK ولكنها لا تستفيد حاليًا من إطار عمل التكامل المالي. تم التخطيط لعملية ترحيل هذه الوظيفة إلى إطار عمل التكامل المالي لتحديثات لاحقة.


- [التوقيع الرقمي الخاص بفرنسا](emea-fra-cash-registers.md)
- [التوقيع الرقمي الخاص بالنرويج‬](emea-nor-cash-registers.md)

لا تستخدم وظيفة التكامل المالي القديمة التالية المتاحة في Retail SDK إطار عمل التكامل المالي، وسوف تُهمل في التحديثات اللاحقة:

- [نموذج تكامل وحدة التحكم للسويد (قديم)](./retail-sdk-control-unit-sample.md)


[!INCLUDE[footer-include](../../includes/footer-banner.md)]