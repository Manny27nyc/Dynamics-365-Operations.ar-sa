---
title: وحدة للدفع
description: يتناول هذا المقال الوحدة النمطية للدفع ويشرح كيفية تكوينها في Microsoft Dynamics 365 Commerce.
author: anupamar-ms
ms.date: 04/12/2022
ms.topic: article
ms.prod: ''
ms.technology: ''
audience: Application user
ms.reviewer: v-chgriffin
ms.search.region: Global
ms.author: anupamar
ms.search.validFrom: 2019-10-31
ms.dyn365.ops.version: Release 10.0.14
ms.custom: ''
ms.assetid: ''
ms.openlocfilehash: fa1482cb73a40df5f9bc9d3037196def71accf18
ms.sourcegitcommit: 87e727005399c82cbb6509f5ce9fb33d18928d30
ms.translationtype: HT
ms.contentlocale: ar-SA
ms.lasthandoff: 08/12/2022
ms.locfileid: "9279465"
---
# <a name="payment-module"></a>وحدة للدفع

[!include [banner](includes/banner.md)]

يتناول هذا المقال الوحدة النمطية للدفع ويشرح كيفية تكوينها في Microsoft Dynamics 365 Commerce.

تتيح الوحدة النمطية للدفع للعملاء بتسديد قيمة الأوامر باستخدام بطاقة الائتمان أو بطاقة الخصم. يتم توفير سلامة الدفع لهذه الوحدة النمطية باستخدام موصل دفع Dynamics 365 لـ Adyen‬. للحصول على معلومات حول كيفية إعداد وتكوين موصل الدفع، راجع [موصل دفع Dynamics 365 لـ Adyen‬](dev-itpro/adyen-connector.md).  

واعتبارًا من 10.0.14 من Commerce، تم أيضًا دمج وحدة الدفع مع Dynamics 365 Payment Connector لـ PayPal للسماح للعملاء بالدفع مقابل الأوامر باستخدام PayPal. للحصول على معلومات حول كيفية إعداد وتكوين Dynamics 365 Payment Connector لـ PayPal، راجع [Dynamics 365 Payment Connector لـ PayPalAdyen‬](paypal.md). 

## <a name="dynamics-365-payment-connector-for-adyen"></a>موصل دفع Dynamics 365 لـ Adyen 

تستضيف الوحدة النمطية للدفع معلومات الدفع التي يتم تقديمها عبر Adyen في اطار HTML مضمن (iframe). تتفاعل الوحدة النمطية للدفع مع Commerce Scale Unit لاسترداد معلومات دفع Adyen. وكجزء من تفاعل Commerce Scale Unit، بإمكان الوحدة النمطية للدفع أن تسمح بتقديم معلومات عنوان الفوترة إما في iframe عبر Adyen أو كوحدة نمطية منفصلة. في نسق ‏‫Fabrikam‬، يتم تمكين عنوان الفوترة في وحدة نمطية منفصلة. يسمح هذا الأسلوب بالحصول على مرونة أكبر في التنسيق، نظرًا لإمكانية عرض بنود العنوان بحيث تشبه بنود عنوان الشحن.

وتتيح أيضًا الوحدة النمطية للدفع للعملاء الذين سجلوا دخولهم بحفظ معلومات الدفع الخاصة بهم. تُحفظ معلومات الدفع وعنوان الفوترة وتتم إدارتها بواسطة موصل دفع Adyen.

تغطي الوحدة النمطية للدفع مصاريف الأوامر التي لم تتم تغطيتها بواسطة نقاط الولاء أو بطاقة هدايا. إذا تمت تغطية القيمة الإجمالية للأمر بواسطة نقاط الولاء أو أرصدة بطاقات الهدايا، فستكون الوحدة النمطية للدفع مخفية، وسيتمكن العميل من تسجيل الأمر من دونها.

يدعم أيضًا موصل دفع Adyen مصادقة العملاء القوية (SCA) يتطلب جزء من التوجيه لخدمات الدفع المُعدلة (PSD2) في الاتحاد الأوروبي أن تتم مصادقة المتسوقين عبر الإنترنت خارج تجربة التسوق الخاصة بهم عبر الإنترنت عندما يستخدمون طريقة دفع إلكترونية. أثناء عملية سير عمل السداد مع الخروج، تتم إعادة توجيه العملاء إلى موقعهم المصرفي، وبعد المصادقة تتم إعادة توجيههم مرة أخرى إلى عملية سير عمل السداد مع الخروج في Commerce. أثناء عملية إعادة التوجيه هذه، سيستمر وجود المعلومات التي أدخلها العميل أثناء عملية سير عمل السداد مع الخروج (على سبيل المثال، عنوان الشحن وخيارات التسليم ومعلومات بطاقة الهدايا ومعلومات الولاء). قبل أن تتمكن من تشغيل ميزة موصل المدفوعات Adyen، يتعين تكوين موصل الدفع لـ SCA في المراكز الرئيسية لـ Commerce. لمزيد من المعلومات، راجع [مصادقة العميل القوية باستخدام Adyen‎](adyen_redirect.md). تم تمكين هذه الميزة في الإصدار 10.0.12 من Commerce.

> [!NOTE]
> بالنسبة لموصل المدفوعات Adyen، يمكن عرض الوحدة النمطية iframe في الوحدة النمطية للدفع فقط إذا قمت بإضافة عنوان Adyen URL إلى قائمة السماح الخاصة بموقعك. لإكمال هذه الخطوة ، قم بإضافة **\*.adyen.com** إلى توجيهات **child-src** و **connect-src** و **img-src** و **script-src** و **style-src** الخاصة بسياسة أمان محتوى الموقع. لمزيد من المعلومات، راجع [إدارة سياسة أمان المحتوى](manage-csp.md). 

يعرض الشكل التوضيحي التالي مثالاً عن وحدات بطاقة الهدايا ونقاط الولاء وموصل المدفوعات Adyen في صفحة السداد مع الخروج.

![مثال على الوحدات النمطية لبطاقة الهدايا ونقاط الولاء وموصل المدفوعات Adyen في صفحة السداد مع الخروج.](./media/ecommerce-payments.PNG)

## <a name="dynamics-365-payment-connector-for-paypal"></a>Dynamics 365 Payment Connector لـ PayPal

واعتبارًا من الإصدار 10.0.14 من Commerce، فان الوحدة النمطية للدفع يتم أيضًا دمجها مع Dynamics 365 Payment Connector لـ PayPal. للحصول على معلومات حول كيفية إعداد وتكوين موصل الدفع هذا، راجع [Dynamics 365 Payment Connector لـ PayPal‬](paypal.md).
 
في صفحة السداد والخروج، يمكنك تكوين موصلات Adyen و PayPal. تم تحسين وحدة الدفع بخصائص إضافية للمساعدة في تحديد الموصل الذي يجب أن تعمل باستخدامه. للحصول على تفاصيل، راجع **أنواع طرق الدفع المعتمدة** وخصائص الوحدة النمطية **الدفع الأساسي** في الجدول التالي.
  
عند تكوين الوحدة النمطية للدفع لاستخدام موصل الدفع PayPal، يظهر زر PayPal في صفحة السداد والخروج. عند الاستدعاء من طرف العميل، تعرض الوحدة النمطية للدفع إطار iframe يحتوي على معلومات PayPal. يمكن للعميل تسجيل الدخول وتوفير معلومات PayPal الخاصة بهم ضمن iframe لإكمال الحركة الخاصة بهم. عندما يختار العميل الدفع باستخدام PayPal، سيتم خصم الرصيد المتبقي في الأمر عبر PayPal.

لا يتطلب موصل الدفع PayPal وحدة عنوان الفوترة لأن PayPal يتعامل مع جميع المعلومات المتعلقة بالفوترة ضمن إطار iframe الخاص به. ومع ذلك، فإن عنوان الشحن ووحدات خيارات التسليم مطلوبة.

يبين الرسم التوضيحي التالي مثالاً لوحدتي دفع على صفحة الدفع، إحداهما تم تكوينها باستخدام موصل الدفع Adyen والأخرى باستخدام موصل الدفع PayPal.
![مثال لوحدات الدفع باستخدام Adyen وPayPal على صفحة السداد مع الخروج.](./media/ecommerce-paypal.png)

يبين الرسم التوضيحي التالي مثالاً على PayPal iframe الذي تم استدعاؤه باستخدام زر PayPal. 
![مثال على Paypal iframe على صفحة السداد مع الخروج.](./media/ecommerce-paypal-iframe.png)

## <a name="payment-module-properties"></a>خصائص الوحدة النمطية للدفع

| اسم الخاصية | القيم | الوصف |
|---------------|--------|-------------|
| العنوان | نص العنوان | عنوان اختياري للوحدة النمطية للدفع. |
| ارتفاع iframe | بكسل | ارتفاع iframe بالبكسل. يمكن ضبط الارتفاع كما هو مطلوب. |
| إظهار عنوان الفاتورة | **صحيح** أم **خطأ** | إذا تم تعيين هذه الخاصية إلى **صواب**، سيتم تقديم عنوان الفاتورة بواسطة Adyen داخل iframe للوحدة النمطية للدفع. إذا تم تعيينها إلى **خطأ**، فلن يتم عرض عنوان الفوترة بواسطة Adyen، وسيتعين على مستخدم Commerce تكوين وحدة نمطية لعرض عنوان الفوترة على صفحة السداد مع الخروج. بالنسبة لموصل الدفع PayPal، ليس لهذا الحقل أي تأثير، حيث يتم التعامل مع عنوان الفواتير بالكامل داخل PayPal. |
| تجاوز نمط الدفع | كود أوراق الأنماط المتتالية (CSS) | بسبب استضافة الوحدة النمطية للدفع في iframe، هناك إمكانية محدودة لتطبيق الأنماط. يمكنك تطبيق بعض الأنماط باستخدام هذه الخاصية. لتجاوز أنماط الموقع، يجب عليك لصق كود CSS كقيمة لهذه الخاصية. لا تنطبق تجاوزات وأنماط CSS منشئ الموقع على هذه الوحدة النمطية. |
|أنواع طرق الدفع المدعومة| سلسلة| إذا تم تكوين موصلات دفع متعددة، فينبغي عليك توفير سلسلة أنواع طرق الدفع المعتمدة‬‏‫ كما هو محدد في تكوين موصل الدفع للمراكز الرئيسية لـ Commerce (طالع الصورة التالية). إذا كان فارغًا، فسيتم تعيينه افتراضيًا على موصل الدفع Adyen. تمت إضافتها في الإصدار 10.0.14 من Commerce.|
|عبارة عن عملية دفع أولية|  **صحيح** أم **خطأ** | إذا كانت القيمة **صحيح**، سيتم إنشاء أي رسائل خطأ من موصل الدفع الأساسي في صفحة السداد مع الخروج. إذا تم تكوين موصلات الدفع Adyen وPayPal، فقم بتعيين Adyen إلى **صحيح**، والذي تمت إضافته في الإصدار 10.0.14 من Commerce.|
|استخدام معرف الموصل| **صحيح** أم **خطأ** | استخدم هذه الخاصية إذا تم تكوين موصلات دفع متعددة للموقع. في حالة القيمة **صواب**، سوف تحتاج الموصلات إلى استخدام معرف الموصل لارتباط الدفع.|
|استخدام رمز لغة مجموعة المستعرض لـ iFrame|  **صحيح** أم **خطأ** | (Adyen فقط) في حالة القيمة **صواب**, سيعرض Adyen iFrame اللغة القائمة على سياق متصفح مستخدم الموقع بدلاً من استخدام رمز اللغة لقناة Commerce المكونة للموقع. تمت إضافتها في الإصدار 10.0.27 من Commerce.|

يبين الرسم التوضيحي التالي مثالاً لقيمة **‬‏‫أنواع طرق الدفع المعتمدة‬‏‫** التي تم تعيينها على "PayPal" في تكوين موصل الدفع في المراكز الرئيسية لـ Commerce.
![مثال على أنواع طرق الدفع المعتمدة في المراكز الرئيسية لـ Commerce.](./media/ecommerce-paymenttendertypes.png)

## <a name="billing-address"></a>عنوان الفوترة

يمكن استخدام الوحدة النمطية لعنوان الفاتورة في صفحة السداد مع الخروج إذا كانت سطور عنوان فوترة لموصل الدفع Adyen لا تتطابق بشكل كافٍ مع مظهر باقي الموقع. 

لاستخدام وحدة عنوان الفوترة في صفحة السداد مع الخروج عندما يتم دمج الوحدة النمطية للدفع مع موصل الدفع Adyen، قم بتعيين خاصية **إظهار عنوان الفاتورة** إلى **خطأ** بحيث يمكن استخدام الوحدة النمطية لعنوان الدفع المخصص بدلاً من عنوان فوترة Adyen الافتراضي. في هذه الحالة، يتعين على مؤلف الموقع تضمين وحدة عنوان الفاتورة في صفحة السداد مع الخروج. ويسمح موصل الدفع Adyen أيضًا بالقدرة على استخدام عنوان الشحن كعنوان للفاتورة وذلك لتقليل عدد الخطوات لمستخدم الموقع.

وعلى غرار الوحدات النمطية للدفع، تمت إضافة خاصية **أنواع طرق الدفع المعتمدة** إلى وحدة عنوان الفواتير في الإصدار 10.0.14 من Commerce. يجب أن تكون قيمة هذه الخاصية مطابقة للقيمة المقدمة في الوحدة النمطية للدفع للتأكد من أنها تعمل معًا. بالنسبة لموصل الدفع Adyen، يتعين أن تترك كل من الوحدة النمطية للدفع ووحدة عنوان الفاتورة هذه القيمة فارغة (الحالة الافتراضية). بالنسبة لموصل PayPal، لا يلزم وجود وحدة مخصصة لعنوان الفاتورة. بالنسبة للأنواع الأخرى من موصلات الدفع، ينبغي توفير السلسلة كما تم تكوينها في المراكز الرئيسية لـ Commerce.

## <a name="add-a-payment-module-to-a-checkout-page-and-set-the-required-properties"></a>إضافة وحدة نمطية للدفع إلى صفحة السداد مع الخروج وتعيين الخصائص المطلوبة

يمكن إضافة وحده نمطية للدفع فقط إلى وحدة نمطية للسداد مع الخروج. لمزيد من المعلومات حول كيفية تكوين وحدة نمطية للدفع لصفحة السداد مع الخروج، راجع [الوحدة النمطية للسداد مع الخروج](add-checkout-module.md).

## <a name="configure-the-adyen-and-paypal-payment-connectors-when-both-are-used"></a>تكوين موصلات دفع Adyen وPayPal عند استخدامهما

في حالة استخدام كل من موصلات دفع Adyen وPayPal لموقعك، اتبع الخطوات التالية في منشئ موقع Commerce لإضافة الوحدات النمطية للدفع لكل موصل إلى الوحدة النمطية للسداد مع الخروج، ثم قم بتكوين الخصائص لكل وحدة نمطية.

1. في الجزء الخصائص للوحدة النمطية لدفع PayPal، اتبع الخطوات التالية:

    1. في الحقل لخاصية **أنواع طرق الدفع المعتمدة**، أدخل **PayPal**.
    1. قم بإلغاء تحديد خانة الاختيار للخاصية **الدفع الأساسي**.
    1. حدد خانة الاختيار للخاصية **استخدام معرف الموصل**.

1. في الجزء الخصائص للوحدة النمطية لدفع Adyen، اتبع الخطوات التالية:

    1. اترك الحقل لخاصية **أنواع طرق الدفع المعتمدة** فارغًا.
    1. قم بتحديد خانة الاختيار للخاصية **الدفع الأساسي**.
    1. حدد خانة الاختيار للخاصية **استخدام معرف الموصل**.

> [!NOTE]
> عند تكوين موصلات Adyen وPayPal ليتم استخدامهما معًا، يجب أن يكون تكوين **موصل دفع Dynamics 365 لـ Adyen** في الموضع الأول في تكوين موصل **حسابات الدفع** الخاص بالقناة عبر الإنترنت في مركز Commerce الرئيسي. لتأكيد أو تغيير ترتيب الموصل، انتقل إلى **المتاجر عبر الإنترنت**، وحدد القناة لموقعك. ثم، في علامة التبويب **إعداد**، في علامة التبويب السريعة **حسابات الدفع**، ضمن **الموصل**، تأكد من أن تكوين **موصل دفع Dynamics 365 لـ Adyen** في الموضع الأول (أي في الخط العلوي)، وأن تكوين **موصل دفع Dynamics 365 لـ PayPal** في الخط الثاني. قم بإضافة الموصلات أو إزالتها حسب الحاجة لإعادة ترتيبها.

## <a name="additional-resources"></a>الموارد الإضافية

[وحدة عربة التسوق](add-cart-module.md)

[وحدة رمز عربة التسوق](cart-icon-module.md)

[وحدة السداد مع الخروج](add-checkout-module.md)

[الوحدة النمطية لعنوان الشحن](ship-address-module.md)

[الوحدة النمطية لخيارات التسليم](delivery-options-module.md)

[الوحدة النمطية لمعلومات الالتقاط](pickup-info-module.md)

[الوحدة النمطية لتفاصيل الأوامر](order-confirmation-module.md)

[الوحدة النمطية لبطاقة الهدايا](add-giftcard.md)

[موصل دفع Dynamics 365 لـ Adyen](dev-itpro/adyen-connector.md)

[Dynamics 365 Payment Connector لـ PayPal](paypal.md)

[مصادقة العملاء القوية باستخدام Adyen](adyen_redirect.md)


[!INCLUDE[footer-include](../includes/footer-banner.md)]
