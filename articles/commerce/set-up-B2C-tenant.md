---
title: إعداد مستأجر B2C في Commerce
description: يصف هذا الموضوع كيفية إعداد مستأجري متاجرة بين عمل ومستهلك (B2C) في Azure Active Directory (Azure AD) لمصادقة موقع المستخدم في Dynamics 365 Commerce.
author: BrianShook
ms.date: 02/11/2022
ms.topic: article
ms.prod: ''
ms.technology: ''
ms.search.form: ''
audience: Application User
ms.reviewer: v-chgri
ms.search.region: Global
ms.search.industry: retail
ms.author: brshoo
ms.search.validFrom: 2020-02-13
ms.dyn365.ops.version: ''
ms.openlocfilehash: d4cbb117e47940491266134fb1e2dbe87374d4a3
ms.sourcegitcommit: 3105642fca2392edef574b60b4748a82cda0a386
ms.translationtype: HT
ms.contentlocale: ar-SA
ms.lasthandoff: 02/12/2022
ms.locfileid: "8109876"
---
# <a name="set-up-a-b2c-tenant-in-commerce"></a>إعداد مستأجر B2C في Commerce

[!include [banner](includes/banner.md)]

يصف هذا الموضوع كيفية إعداد مستأجري متاجرة بين عمل ومستهلك (B2C) في Azure Active Directory (Azure AD) لمصادقة موقع المستخدم في Dynamics 365 Commerce.

يقوم Dynamics 365 Commerce باستخدام Azure AD B2C لدعم بيانات اعتماد المستخدم وتدفقات المصادقة. بإمكان المستخدم التسجيل وتسجيل الدخول وإعادة تعيين كلمة المرور من خلال هذه التدفقات. يقوم Azure AD B2C بتخزين معلومات المصادقة الحساسة، مثل اسم المستخدم وكلمه المرور. سيقوم سجل المستخدم في مستأجر B2C بتخزين سجل حساب محلي B2C أو سجل موفر هوية اجتماعية B2C. سترتبط سجلات B2C هذه من جديد بسجل العميل في بيئة Commerce.

> [!WARNING] 
> سيُوقف Azure AD B2C عمليات سير عمل المستخدمين القدامى بحلول 1 أغسطس2021. لذلك، يجب أن تخطط لترحيل تدفقات المستخدم إلى الإصدار الجديد الموصى به. يوفر الإصدار الجديد تماثل ميزات وميزات جديده. يجب استخدام مكتبة الوحدات لإصدار Commerce رقم 10.0.15 أو إصدار أحدث مع عمليات سير عمل مستخدم B2C الموصى بها. لمزيد من المعلومات، راجع [عمليات سير عمل المستخدمين في Azure Active Directory B2C](/azure/active-directory-b2c/user-flow-overview).
 
 > [!NOTE]
 > تأتي بيئات تقييم Commerce مع مستأجر Azure AD B2C المحمل مسبقًا لأغراض التوضيح. لا يلزم تحميل مستأجر Azure AD  B2Cالخاص بك باستخدام الخطوات التالية لبيئات التقييم.

> [!TIP]
> يمكنك حماية مستخدمي موقعك وتعزيز أمان مستأجري Azure AD B2Cمع حماية الهوية والوصول المشروط في Azure AD. لمراجعة القدرات المتاحة للمستأجرين في Azure AD من الفئة B2C Premium P1 وP2 المميزين، راجع [حماية الهوية والوصول المشروط إلى Azure AD ‏B2C](/azure/active-directory-b2c/conditional-access-identity-protection-overview).

## <a name="dynamics-environment-prerequisites"></a>متطلبات بيئة Dynamics الأساسية

قبل البدء، تأكد من أن بيئة Dynamics 365 Commerce وقناة التجارة الإلكترونية مكونة بشكل مناسب عن طريق تحقيق المتطلبات الأساسية التالية.

- قم بتعيين عمليات نقطة البيع **AllowAnonymousAccess** إلى "1" في المركز الرئيسي لـ Commerce:
    1. الانتقال إلى **عمليات نقطه البيع**.
    1. في شبكة العمليات، انقر بزر الماوس الأيمن وحدد **تخصيص**.
    1. حدد **إضافة حقل**.
    1. في قائمة الأعمدة المتوفرة، حدد عمود **AllowAnonymousAccess** لإضافته.
    1. حدد **تحديث**.
    1. بالنسبة للعملية **612** "إضافة عميل"، قم بتغيير **AllowAnonymousAccess** إلى "1."
    1. قم بتشغيل المهمة **1090 (السجلات)**.
- قم بتعيين السمة **يدوي** لحساب عميل التسلسل الرقمي إلى **لا** في المركز الرئيسي لـ Commerce:
    1. انتقل إلى **Retail وCommerce \> إعداد المراكز \> المعلمات \> معلمات الحسابات المدينة**.
    1. حدد **تسلسلات رقمية**.
    1. في صف **حساب العميل**، انقر نقرا مزدوجا فوق قيمة **كود التسلسل الرقمي**.
    1. في علامة التبويب السريعة **عام** للتسلسل الرقمي، قم بتعيين **يدوي** إلى **لا**.

بعد نشر بيئة Dynamics 365 Commerce الخاصة بك، يوصى أيضًا بـ [تهيئة البيانات الأولية](enable-configure-retail-functionality.md) في البيئة.

## <a name="create-or-link-to-an-existing-azure-ad-b2c-tenant-in-the-azure-portal"></a>إنشاء مستأجر Azure AD B2C موجود في مدخل Azure أو الارتباط به

يغطي هذا القسم إنشاء مستأجر Azure AD B2C لاستخدامه في موقع التجارة أو ربطه. ولمزيد من المعلومات، راجع [البرنامج التعليمي: إنشاء Azure Active Directory مستأجر B2C](/azure/active-directory-b2c/tutorial-create-tenant).

1. سجل الدخول إلى [مدخل Azure ](https://portal.azure.com/).
1. من قائمة مدخل Azure، حدد **إنشاء مورد**. احرص على استخدام الاشتراك والدليل الذي سيتم توصيله ببيئة Commerce.

    ![إنشاء مورد في مدخل Azure.](./media/B2CImage_1.png)

1. انتقل إلى **الهوية \> Azure Active Directory B2C**.
1. عند وصولك إلى صفحة **إنشاء مستأجر B2C جديد أو الارتباط بمستأجر موجود**، استخدم أحد الخيارات أدناه الأكثر ملاءمة لاحتياجات شركتك:

    - **إنشاء مستأجر Azure AD B2C جديد**: استخدم هذا الخيار لإنشاء مستأجر Azure AD B2C جديد.
        1. حدد **إنشاء مستأجر Azure AD B2C جديد**.
        1. ضمن **اسم المؤسسة**، أدخل اسم المؤسسة.
        1. ضمن **اسم المجال الأولي**، أدخل اسم المجال الأولي‏‎.
        1. في **البلد أو المنطقة**، حدد البلد أو المنطقة.
        1. حدد **إنشاء** لإنشاء المستأجر.

     ![إنشاء مستأجر Azure AD جديد.](./media/B2CImage_2.png)

     - **ربط مستأجر Azure AD B2C موجود باشتراكي في Azure**: استخدم هذا الخيار إذا كان لديك مستأجر Azure AD B2C تريد الارتباط به.
        1. حدد **ربط مستأجر Azure AD B2C موجود باشتراكي في Azure**.
        1. في **مستأجر Azure AD B2C**، حدد مستأجر B2C المناسب. إذا ظهرت الرسالة "لم يتم العثور على مستأجري B2C مؤهلين" في مربع التحديد، فهذا يعني عدم وجود مستأجر B2C مؤهل ويجب إنشاء واحد جديد.
        1. في **مجموعة الموارد**، حدد **إنشاء جديد**. أدخل **اسم** مجموعة الموارد التي ستحتوي على المستأجر، وحدد، **موقع مجموعة الموارد**، ثم حدد **إنشاء**.

    ![ربط مستأجر Azure AD B2C موجود باشتراك Azure.](./media/B2CImage_3.png)

1. بعد إنشاء دليل Azure AD B2C الجديد (قد يستغرق هذا الأمر لحظات قليلة)، سيظهر ارتباط إلى الدليل الجديد على لوحة المعلومات. سيوجهك هذا الارتباط إلى صفحة "مرحباً بك في Azure Active Directory B2C".

    ![ارتباط إلى دليل Azure AD Directory جديد](./media/B2CImage_4.png)

> [!NOTE]
> إذا كانت لديك اشتراكات متعددة داخل حساب Azure أو قمت بإعداد مستأجر B2C بدون إنشاء ارتباط إلى اشتراك نشط، سيقوم شعار **استكشاف الأخطاء وإصلاحها** بتوجيهك لربط المستأجر باشتراك. حدد رسالة استكشاف الأخطاء وإصلاحها واتبع الإرشادات لحل مشكلة الاشتراك.

تبين الصورة التالية مثالاً عن شعار **استكشاف الأخطاء وإصلاحها في Azure AD B2C**.

![تحذير يشير إلى عدم وجود اشتراك نشط لدى الدليل.](./media/B2CImage_5.png)

## <a name="create-the-b2c-application"></a>إنشاء تطبيق B2C

بعد إنشاء مستأجر B2C، ستقوم بإنشاء تطبيق B2C داخل مستأجر Azure AD B2C للتفاعل مع Commerce.

لإنشاء تطبيق B2C، اتبع هذه الخطوات.

1. في مدخل Azure، حدد **تسجيلات التطبيق**، ثم حدد **تسجيل جديد**.
1. ضمن **الاسم**، أدخل الاسم لتسمية تطبيق Azure AD B2C هذا به.
1. ضمن **أنواع الحسابات المدعومة**، حدد **الحسابات في أي موفر هوية أو دليل تنظيمي (لمصادقة المستخدمين بعمليات سير عمل المستخدمين)**.
1. بالنسبة إلى **عنوان URI لإعادة التوجيه**، أدخل عناوين URL للردود المخصصة كنوع **الويب**. للحصول على معلومات حول عناوين URL للرد وكيفية تنسيقها، راجع [عناوين URL للردود](#reply-urls) أدناه. يجب إدخال عنوان URI لإعادة التوجيه أو عنوان URL الخاص بالرد لتمكين عمليات إعادة التوجيه من Azure AD B2C مرة أخرى إلى موقعك عند قيام مستخدم بالمصادقة. يمكن إضافة عنوان URL الخاص بالرد أثناء عملية التسجيل، أو يمكن إضافته لاحقًا من خلال تحديد الارتباط **إضافة عنوان URI لإعادة التوجيه** من قائمة **نظرة عامة** في قسم **نظرة عامة** في تطبيق B2C.
1. للحصول على **الأذونات**، حدد **منح موافقة المسؤول على أذونات openid و offline_access**.
1. حدد **السجل**.
1. حدد التطبيق الذي تم إنشاؤه حديثًا وانتقل إلى قائمه **المصادقة**. 
1. إذا تم إدخال عنوان URL الخاص بالرد، ضمن **المنح الضمني والتدفقات المختلطة** حدد الخيار **الرموز المميزة للوصول** والخيار **الرموز المميزة للمعرفات** لتمكينها للتطبيق، ثم حدد **حفظ**. إذا لم يتم إدخال عنوان URL الخاص بالرد أثناء التسجيل، فيمكن إضافته أيضًا على هذه الصفحة بتحديد **إضافة نظام أساسي**، وتحديد **ويب**، ثم إدخال عنوان URI لإعادة التوجيه الخاص بالتطبيق. سيتوفر قسم **المنح الضمني والتدفقات المختلطة** بعد ذلك لتحديد كل من خيار **الرموز المميزة للوصول** وخيار **الرموز المميزة للمعرفات**.
1. انتقل إلى قائمة **النظرة العامة** في مدخل Azue وانسخ **معرف التطبيق (العميل)**. لاحظ هذا المعرف لخطوات الاعداد التالية (المشار اليها فيما بعد باعتباره **المعرف الفريد العمومي للعميل**).

للحصول علي مرجع إضافي حول تسجيلات التطبيق في Azure ADB2C، يُرجى مراجعة [تجربه تسجيلات التطبيق الجديدة لـ Azure Active Directory B2C](/azure/active-directory-b2c/app-registrations-training-guide)

### <a name="reply-urls"></a>عناوين URL الخاصة بالرد

تعتبر عناوين URL الخاصة بالرد مهمة لأنها توفر قائمة بيضاء للمجالات المرتجعة عندما يقوم موقعك باستدعاء Azure AD B2C لمصادقة مستخدم. يسمح ذلك بإرجاع المستخدم الذي تمت مصادقته إلى المجال الذي يتم تسجيل الدخول منه (مجال موقعك). 

في المربع **عنوان URL الخاص بالرد** على شاشة **Azure AD B2c - تطبيقات \> تطبيق جديد**، تحتاج إلى إضافة خطوط منفصلة لكل من مجال الموقع و(بعد تزويد بيئتك) عنوان URL المنشأ في Commerce. يجب أن تستخدم عناوين URL هذه دائمًا تنسيق URL صالحًا ويجب أن تكون عناوين URL أساسية فقط (لا توجد أي خطوط مائلة أمامية أو مسارات). يجب إلحاق السلسلة ``/_msdyn365/authresp`` بعناوين URL الأساسية، كما في الأمثلة التالية:

- ``https://www.fabrikam.com/_msdyn365/authresp``(يجب أن يطابق المجال مجال التجارة الإلكترونية بالكامل. إذا كان لديك مجالات متعددة، فأنت بحاجة إلى إضافةعنوان URL هذا لكل مجال.)
- ``https://fabrikam-prod.commerce.dynamics.com/_msdyn365/authresp``

## <a name="create-user-flow-policies"></a>إنشاء سياسات تدفق المستخدم

سياسات تدفق المستخدم هي السياسات التي يستخدمها Azure AD B2C لتوفير تجارب مستخدم آمنة للتسجيل وتسجيل الدخول وتحرير ملف التعريف ونسيان كلمه المرور. يستخدم Dynamics 365 Commerce  هذه التدفقات لتنفيذ إجراءات السياسة للتفاعل مع مستأجر Azure AD B2C. عندما يتفاعل المستخدم مع هذه السياسات، يعاد توجيههم إلى مستأجر Azure AD B2C لتنفيذ الإجراءات.

يوفر Azure AD B2C ثلاثة أنواع من تدفقات المستخدم الأساسية:
- التسجيل وتسجيل الدخول
- تحرير ملف التعريف
- إعادة تعيين كلمة المرور

يمكنك اختيار استخدام تدفقات المستخدم الافتراضية التي يوفرها Azure AD، والتي ستقوم بعرض صفحة يستضيفها Azure AD B2C. أو يمكنك إنشاء صفحة HTML للتحكم في شكل وأسلوب تجارب تدفق المستخدم هذه. 

لتخصيص صفحات سياسة المستخدم مع الضفحات المضمنة في Dynamics 365 Commerce، راجع [إعداد صفحات مخصصة لعمليات تسجيل دخول المستخدمين‬](custom-pages-user-logins.md). للحصول على معلومات إضافية، راجع [تخصيص واجهة تجارب المستخدم في Azure Active Directory B2C](/azure/active-directory-b2c/tutorial-customize-ui).

### <a name="create-a-sign-up-and-sign-in-user-flow-policy"></a>إنشاء عملية تسجيل وتسجيل دخول في سياسة تدفق المستخدم

لإنشاء عملية تسجيل وتسجيل دخول في سياسة تدفق المستخدم، اتبع الخطوات التالية.

1. في مدخل Azure، حدد **تدفقات المستخدم (السياسات)** في جزء التنقل الأيمن.
1. في صفحة **Azure AD B2C – تدفقات المستخدم (السياسات)‬‏‫**، حدد **تدفق مستخدم جديد‬‏‫**.
1. حدد سياسة **تسجيل الاشتراك وتسجيل الدخول**، ثم حدد الإصدار **الموصى به**.
1. ضمن **الاسم**، أدخل اسمًا للسياسة. سيظهر هذا الاسم بعد ذلك مع بادئة يعينها المدخل (على سبيل المثال، "B2C_1_").
1. ضمن **موفرو الهوية**، في قسم **الحسابات المحلية**، حدد **تسجيل الاشتراك بالبريد الإلكتروني‬‏‫**. يتم استخدام مصادقة البريد الإلكتروني في السيناريوهات الأكثر شيوعًا لـ Commerce. إذا كنت تستخدم أيضًا مصادقة موفر الهوية الاجتماعية، فيمكن أيضًا تحديدها في هذا الوقت.
1. ضمن **مصادقة متعددة العوامل**، حدد الاختيار المناسب لشركتك. 
1. ضمن **سمات ومطالبات المستخدم**، حدد الخيارات لجمع السمات أو إرجاع المطالبات حسب الحاجة. حدد **إظهار المزيد...** للحصول على قائمة كاملة بخيارات السمات والمطالبات. يحتاج Commerce إلى الخيارات الافتراضية التالية:

    | **جمع سمة** | **إرجاع مطالبة** |
    | ---------------------- | ----------------- |
    | عنوان البريد الإلكتروني          | عناوين البريد الإلكتروني   |
    | الاسم المحدد             | الاسم المحدد        |
    |                        | موفر الهوية‬ |
    | اللقب                | اللقب           |
    |                        | معرف الكائن الخاص بالمستخدم  |

1. حدد **إنشاء**.

الصورة التالية هي مثال تدفق المستخدم للتسجيل وتسجيل الدخول إلى Azure AD B2C.

![إعدادات سياسة التسجيل وتسجيل الدخول.](./media/B2CImage_11.png)

   
### <a name="create-a-profile-editing-user-flow-policy"></a>إنشاء سياسة تدفق المستخدم لتحرير ملف التعريف

لإنشاء سياسة تدفق المستخدم لتحرير ملف التعريف، اتبع الخطوات التالية.

1. في مدخل Azure، حدد **تدفقات المستخدم (السياسات)** في جزء التنقل الأيمن.
1. في صفحة **Azure AD B2C – تدفقات المستخدم (السياسات)‬‏‫**، حدد **تدفق مستخدم جديد‬‏‫**.
1. حدد **تحرير ملف التعريف**، ثم حدد الإصدار **الموصى به**.
1. ضمن **الاسم**، أدخل تدفق المستخدم لتحرير ملف التعريف. سيظهر هذا الاسم بعد ذلك مع بادئة يعينها المدخل (على سبيل المثال، "B2C_1_").
1. ضمن **موفرو الهوية**، في قسم **الحسابات المحلية**، حدد **تسجيل الدخول إلى البريد الإلكتروني‬‏‫**.
1. ضمن **سمات المستخدم**، حدد خانات الاختيار التالية:
    
    | **جمع سمة** | **إرجاع مطالبة** |
    | ---------------------- | ----------------- |
    |                        | عناوين البريد الإلكتروني   |
    | الاسم المحدد             | الاسم المحدد        |
    |                        | موفر الهوية‬ |
    | اللقب                | اللقب           |
    |                        | معرف الكائن الخاص بالمستخدم  |
    
1. حدد **إنشاء**.

تعرض الصورة التالية مثالاً عن تدفق المستخدم لتحرير مرف تعريف Azure AD B2C.

![مثال على تدفق المستخدم لتحرير ملف تعريف‬ Azure AD B2C](./media/B2CImage_12.png)

### <a name="create-a-password-reset-user-flow-policy"></a>إنشاء سياسة تدفق المستخدم لإعادة تعيين كلمة المرور

لإنشاء سياسة تدفق المستخدم لإعادة تعيين كلمة المرور، اتبع الخطوات التالية.

1. في مدخل Azure، حدد **تدفقات المستخدم (السياسات)** في جزء التنقل الأيمن.
1. في صفحة **Azure AD B2C – تدفقات المستخدم (السياسات)‬‏‫**، حدد **تدفق مستخدم جديد‬‏‫**.
1. حدد **إعادة تعيين كلمة المرور**، ثم حدد الإصدار **الموصى به**.
1. ضمن **الاسم**، أدخل اسمًا لتدفق المستخدم لإعادة تعيين كلمة المرور.
1. ضمن **موفرو الهوية**، حدد **إعادة تعيين كلمة المرور باستخدام عنوان البريد الكتروني**.
1. حدد **إنشاء**.
1. ضمن **مطالبات التطبيق**، حدد خانات الاختيار التالية:
    - **عناوين البريد الإلكتروني**
    - **الاسم المحدد**
    - **اللقب**
    - **معرف الكائن الخاص بالمستخدم**
1. حدد **إنشاء**.

توضح الصورة التالية المكان حيث يجب تعيين الخيار **إعادة تعيين كلمة المرور باستخدام عنوان بريد إلكتروني** في تدفق المستخدم لإعادة تعيين كلمة المرور في Azure AD B2C.

![تعيين "إعادة تعيين كلمة المرور باستخدام عنوان بريد إلكتروني" في سياسة إعادة تعيين كلمة المرور](./media/B2CImage_13.png)

## <a name="add-social-identity-providers-optional"></a>إضافة موفري الهوية الاجتماعية (اختياري)

يسمح موفرو الهوية الاجتماعية للمستخدمين باستخدام حساباتهم الاجتماعية للمصادقة. تعتبر إضافة مصادقة موفر الهوية الاجتماعية اختيارية في Dynamics 365 Commerce. 

إذا لم تتم إضافة مصادقة موفر الهوية الاجتماعية، ستكون ملفات تعريف Azure AD B2C الافتراضية ملفات التعريف الأساسية لقاعدة المستخدمين. سيقوم المستخدمون بتحديد اسم المستخدم (عنوان بريدهم الإلكتروني المفضل) وتعيين كلمة مرور. سيقوم Azure AD B2C بمصادقة المستخدمين بشكل مباشر. 

إذا تمت إضافة مصادقة موفر الهوية الاجتماعية واختار أحد المستخدمين أحد موفري الهوية الاجتماعية المعروضين، فسيتم مع ذلك إنشاء كيان في مستأجر Azure AD B2C. سيقوم Azure AD B2C عندئذٍ بمصادقة بيانات اعتماد المستخدم مع موفر الهوية الاجتماعية.

> [!NOTE]
> يؤدي تسجيل دخول الموفر إلى إنشاء سجل في مستأجر B2C، ولكن بتنسيق مختلف عن الحسابات المحلية لأنه سيقوم باستدعاء مرجع موفر الهوية الاجتماعية الخارجي للمصادقة. يمكن للمستخدم استخدام عنوان البريد الإلكتروني نفسه عبر موفري الهويات الاجتماعية، مما يعني أن اسم المستخدم للبريد الإلكتروني الذي تم استخدامه للمصادقة قد لا يكون فريدًا للمستخدم. سيفرض Azure AD B2C فقط وجود عنوان بريد إلكتروني فريد للمستخدمين على حسابات B2C المحلية.

قبل أن تتمكن من إضافة موفر هوية اجتماعية للمصادقة، يجب الانتقال إلى مدخل موفر الهوية وإعداد تطبيق موفر هوية كما هو موضح في وثائق Azure AD B2C. توجد أدناه قائمة بالارتباطات إلى الوثائق.

- [Amazon](/azure/active-directory-b2c/active-directory-b2c-setup-amzn-app)
- [Azure AD (مستأجر واحد)](/azure/active-directory-b2c/active-directory-b2c-setup-oidc-azure-active-directory)
- [حساب Microsoft](/azure/active-directory-b2c/active-directory-b2c-setup-msa-app)
- [Facebook](/azure/active-directory-b2c/active-directory-b2c-setup-fb-app)
- [GitHub](/azure/active-directory-b2c/active-directory-b2c-setup-github-app)
- [Google](/azure/active-directory-b2c/active-directory-b2c-setup-goog-app)
- [LinkedIn](/azure/active-directory-b2c/active-directory-b2c-setup-li-app)
- [OpenID Connect](/azure/active-directory-b2c/active-directory-b2c-setup-oidc-idp)
- [Twitter](/azure/active-directory-b2c/active-directory-b2c-setup-twitter-app)

### <a name="add-and-set-up-a-social-identity-provider"></a>إضافة موفر هوية اجتماعية وإعداده

لإضافة موفر هوية اجتماعية وإعداده، اتبع الخطوات التالية.  

1. في مدخل Azure، انتقل إلى **موفرو الهوية**.
1. حدد **إضافة**. تظهر الشاشة **إضافة موفر هوية**.
1. ضمن **الاسم**، أدخل الاسم المطلوب عرضه للمستخدمين على شاشة تسجيل الدخول.
1. ضمن **نوع موفر الهوية**، حدد موفر هوية من القائمة.
1. حدد **موافق**.
1. حدد **إعداد موفر الهوية هذا** للوصول إلى شاشة **إعداد موفر الهوية الاجتماعية**.
1. ضمن **معرف العميل**، أدخل معرف العميل كما تم الحصول عليه من إعداد تطبيق موفر الهوية.
1. ضمن **سر العميل**، أدخل سر العميل كما تم الحصول عليه من إعداد تطبيق موفر الهوية.
1. إرفاق تدفق المستخدم لسياسات التسجيل:
1. انتقل إلى **Azure AD B2C – تدفقات المستخدم (السياسات) \> {سياسة التسجيل وتسجيل الدخول} \> موفرو الهوية**.
1. لإرفاق سياسة تدفق المستخدم للتسجيل/تسجيل الدخول، حدد كل موفر هوية قمت بإعداده لحسابك. لاختبار هؤلاء، حدد **تشغيل تدفق المستخدم** لكل موفر هوية. ستعرض علامة تبويب جديدة صفحة تسجيل الدخول التي تعرض مربع تحديد موفر الهوية الجديد.

تظهر الصورة التالية أمثلة عن شاشات **إضافة موفر هوية** و **إعداد موفر الهوية الاجتماعية** في Azure AD B2C.

![إضافة موفر هوية اجتماعية إلى تطبيقك.](./media/B2CImage_14.png)

تعرض الصورة التالية مثالاً عن كيفية تحديد موفري الهوية في صفحة **موفرو هوية** Azure AD B2C.

![حدد كل موفر هوية اجتماعية لتمكينه لسياستك.](./media/B2CImage_16.png)

تعرض الصورة التالية مثالاً عن شاشة تسجيل دخول افتراضية مع عرض زر تسجيل الدخول إلى موفر هوية اجتماعية.

> [!NOTE]
> إذا كنت تستخدم الصفحات المخصصة المضمنة في Commerce لتدفقات المستخدم الخاصة بك، فستحتاج الأزرار الخاصة بموفري الهوية الاجتماعية إلى إضافتها باستخدام ميزات القابلية للتوسعة في مكتبة وحدة Commerce. بالإضافة إلى ذلك، عند إعداد تطبيقاتك باستخدام موفر هوية اجتماعية محدد، قد يكون عنوان URL أو سلاسل التكوين في بعض الحالات حساسة لحالة الأحرف. راجع إرشادات الاتصال الخاصة بموفر الهوية الاجتماعية لمزيد من المعلومات.
 
![مثال عن شاشة تسجيل دخول افتراضية مع عرض زر تسجيل الدخول إلى موفر هوية اجتماعية.](./media/B2CImage_17.png)

## <a name="update-commerce-headquarters-with-the-new-azure-ad-b2c-information"></a>تحديث Commerce headquarters بواسطة معلومات Azure AD B2C جديدة

بعد إكمال خطوات تزويد Azure AD B2C أعلاه، يجب تسجيل تطبيق Azure AD B2C في بيئتك في Dynamics 365 Commerce.

لتحديث المقر الرئيسي بمعلومات Azure AD B2C الجديدة، اتبع هذه الخطوات.

1. في Commerce، انتقل إلى **معلمات Commerce المشتركة**، وحدد **موفرو الهوية** في القائمة اليسرى
1. ضمن **موفرو الهوية**، قم بما يلي:
    1. في مربع **المُصدر**، أدخل سلسة مُصدر موفر الهوية. للعثور على سلسلة المُصدر، راجع [الحصول على سلسلة المُصدر لإعداد المركز الرئيسي](#obtain-issuer-string-for-headquarters-setup) أدناه.
    1. في مربع **الاسم**، أدخل اسمًا لسجل المصدر.
    1. في مربع **النوع**، أدخل **Azure AD B2C (id_token)**.
1. ضمن **الأطراف المعتمِدة**، مع تحديد عنصر موفر هوية B2C أعلاه، قم بما يلي:
    1. في المربع‏‎ **معرف العميل**، أدخل معرف تطبيق B2C. يمكنك العثور على هذا المعرف في مربع **معرف التطبيق** في صفحة خصائص تطبيق B2C.
    1. في مربع **النوع**، أدخل **عام**.
    1. في مربع **نوع المستخدم**، أدخل **عميل**.
1. في جزء الإجراءات، حدد **حفظ**.
1. في مربع البحث في Commerce، ابحث عن **جدول التوزيع**
1. في قائمة التنقل اليسرة من صفحة **جداول التوزيع**، حدد الوظيفة **1110 تكوين عمومي**.
1. في جزء الإجراءات، حدد **تشغيل الآن**.

### <a name="obtain-issuer-string-for-headquarters-setup"></a>الحصول على سلسلة المُصدر لإعداد المركز الرئيسي

للحصول على عنوان URL لسلسلة مُصدر موفر الهوية، اتبع الخطوات التالية.

1. في صفحة Azure AD B2C الخاصة بمدخل Azure، انتقل إلى سير عمل مستخدم **تسجيل الاشتراك وتسجيل الدخول**.
1. حدد **تخطيطات الصفحات** في قائمه التنقل إلى اليسار، ضمن **اسم التخطيط**، حدد **صفحة تسجيل الاشتراك أو تسجيل الدخول الموحد**، ثم حدد **تشغيل سير عمل المستخدم**.
1. تأكد من تعيين تطبيقك إلى تطبيق Azure AD B2C المقصود الذي تم إنشاؤه أعلاه، ثم حدد ارتباط سير عمل المستخدم الذي يظهر ضمن رأس **تشغيل سير عمل المستخدم** الذي يتضمن ``.../.well-known/openid-configuration?p=<B2CSIGN-INPOLICY>``. (لا تحدد **تشغيل سير عمل المستخدم**.)ستفتح علامة تبويب جديدة وتعرض بيانات تعريف للسياسة لتجميع سلسلة المُصدر.
1. في صفحة بيانات التعريف المعروضة في علامة تبويب المستعرض، انسخ سلسلة مُصدر موفر الهوية (قيمة **المُصدر** التي تبدأ بـ "https://" وتنتهي بـ "/v2.0/" ) والتي تبدو مماثلة للمثال التالي.
   - ``https://login.fabrikam.com/011115c3-0113-4f43-b5e2-df01266e24ae/v2.0/``.
 
**أو**: لإنشاء نفس عنوان URL لبيانات التعريف يدويا، قم باجراء الخطوات التالية.

1. قم بإنشاء عنوان URL لعنوان بيانات التعريف بالتنسيق التالي باستخدام سياسة ومستأجر B2C: ``https://<B2CTENANTNAME>.b2clogin.com/<B2CTENANTNAME>.onmicrosoft.com/v2.0/.well-known/openid-configuration?p=<B2CSIGN-INPOLICY>``
    - مثال: ``https://d365plc.b2clogin.com/d365plc.onmicrosoft.com/v2.0/.well-known/openid-configuration?p=B2C_1_signinup``.
1. أدخل عنوان URL لعنوان بيانات التعريف في شريط العناوين في المستعرض.
1. في بيانات التعريف، انسخ عنوان URL لمصدر موفر الهوية (قيمة **"المصدر"**).
    - مثال: ``https://login.fabrikam.com/011115c3-0113-4f43-b5e2-df01266e24ae/v2.0/``.

## <a name="configure-your-b2c-tenant-in-commerce-site-builder"></a>تكوين مستأجر B2C في منشئ موقع Commerce

وبمجرد اكتمال إعداد مستأجر Azure AD B2C، يجب تكوين مستأجر B2C في منشئ موقع Commerce. تتضمن خطوات التكوين تجميع معلومات تطبيق B2C من مدخل Azure، وإدخال معلومات تطبيق B2C في منشئ الموقع، ثم ربط تطبيق B2C بموقعك وقناتك.

### <a name="collect-the-required-application-information"></a>تجميع معلومات التطبيق المطلوبة

لتجميع معلومات التطبيق المطلوبة، اتبع الخطوات التالية.

1. في مدخل Azure، انتقل إلى **الصفحة الرئيسية \> Azure AD B2C - تسجيلات التطبيق**.
1. حدد تطبيقك، ثم حدد **نظرة عامة** في جزء التنقل الأيمن للحصول على تفاصيل التطبيق.
1. من المرجع **معرف التطبيق (العميل)**، قم بتجميع معرف التطبيق الخاص بتطبيق B2C الذي تم إنشاؤه في مستأجر B2C. سيتم إدخاله في وقت لاحق على أنه **GUID‎ العميل** في منشئ الموقع.
1. حدد **إعادة توجيه URIs** واجمع عنوان URL للرد الذي يظهر لموقعك (عنوان URL للرد الذي تم إدخاله عند الإعداد).
1. انتقل إلى **الصفحة الرئيسية \> Azure AD B2C – مهام سير عمل المستخدم**، ثم اجمع أسماء كل سير عمل سياسة للمستخدم.

تعرض الصورة التالية مثالاً عن صفحة النظرة العامة على **Azure AD B2C - تسجيلات التطبيق**.

![صفحة النظرة العامة علة Azure AD B2C - تسجيلات التطبيق مع تمييز معرف التطبيق (العميل)](./media/ClientGUID_Application_AzurePortal.png)

تعرض الصورة التالية مثالاً عن سياسات تدفق المستخدم في صفحة **Azure AD B2C – تدفقات المستخدم (السياسات)**.

![جمع أسماء كل تدفق سياسة B2C.](./media/B2CImage_22.png)

### <a name="enter-your-azure-ad-b2c-tenant-application-information-into-commerce"></a>إدخال معلومات تطبيق مستأجر Azure AD B2C في Commerce

يجب إدخال التفاصيل الخاصة بمستأجر Azure AD B2C في منشئ موقع Commerce قبل ربط مستأجر B2C بموقعك (مواقعك).

لإضافة معلومات تطبيق مستأجر Azure AD B2C إلى Commerce، اتبع الخطوات التالية.

1. سجل دخولك كمسؤول إلى منشئ موقع Commerce لبيئتك.
1. في جزء التنقل الأيسر، حدد **إعدادات المستأجر** لتوسيعه.
1. ضمن **إعدادات المستأجر**، حدد **إعدادات B2C**. 
1. في النافذة الرئيسية، إلى جانب **تطبيقات B2C**، حدد **إدارة**. (إذا ظهر المستأجر في قائمة تطبيقات B2C، فهذا يعني أنه أضيف بواسطة المسؤول. تحقق من تطابق البنود الموجودة في الخطوة 6 أدناه مع تطبيق B2C.)
1. حدد **إضافة تطبيق B2C**.
1. أدخل البنود المطلوبة التالية في النموذج المعروض، باستخدام قيم من مستأجر B2C وتطبيقك. يمكن ترك الحقول غير المطلوبة (تلك التي لا توجد علامة نجمية إلى جانبها) فارغة.

    - **اسم التطبيق**: اسم تطبيق B2C، على سبيل المثال "Fabrikam B2C".
    - **اسم المستأجر**: اسم مستأجر B2C الخاص بك (على سبيل المثال، استخدم "‏‫شركة الاتحاد للتصنيع‬" إذا ظهر المجال على أنه "fabrikam.onmicrosoft.com" للمستاجر B2C). 
    - **معرف سياسة نسيان كلمة المرور**: معرف سياسة تدفق المستخدم لنسيان كلمة المرور، على سبيل المثال "B2C_1_PasswordReset".
    - **معرف سياسة التسجيل وتسجيل الدخول**: معرف سياسة تدفق المستخدم للتسجيل وتسجيل الدخول، على سبيل المثال "B2C_1_signup_signin".
    - **GUID‏‎ العميل**: معرف تطبيق B2C، على سبيل المثال "22290eb2-c52e-42e9-8b35-a2b0a3bcb9e6".
    - **معرف سياسة تحرير ملف التعريف**: معرف سياسة تدفق المستخدم لتحرير ملف التعريف، على سبيل المثال، "B2C_1A_ProfileEdit".

1. حدد **موافق**. من المفترض أن يظهر الآن اسم تطبيق B2C في القائمة.
1. حدد **حفظ** لحفظ تغييراتك.

### <a name="associate-the-b2c-application-to-your-site-and-channel"></a>ربط تطبيق B2C بموقعك وقناتك

> [!WARNING]
> إذا كان موقعك مرتبطًا بتطبيق B2C، فسيؤدي التغيير إلى تطبيق B2C مختلف إلى إزالة المراجع الحالية التي تم تأسيسها للمستخدمين الذين قاموا بالتسجيل في هذه البيئة. إذا حصل التغيير، فإن أي بيانات اعتماد مرتبطة بتطبيق B2C المعين حاليًا لن تكون متوفرة للمستخدمين. 
> 
> قم بتحديث تطبيق B2C فقط إذا كنت تعمل على اعداد تطبيق B2C الخاص بالقناة للمرة الأولى أو إذا كنت تريد من المستخدمين إعادة التسجيل باستخدام بيانات اعتماد جديدة لهذه القناة مع تطبيق B2C الجديد. يجب توخي الحذر عند ربط القنوات بتطبيقات B2C، واحرص على تسمية التطبيقات بطريقة واضحة. إذا لم تكن قناة مرتبطة بتطبيق B2C في الخطوات أدناه، فإن المستخدمين الذين يسجلون دخولهم إلى هذه القناة لموقعك سيدخلون إلى تطبيق B2C الذي يظهر على أنه **افتراضي** في قائمة **إعدادات المستأجر \> إعدادات B2C** لتطبيقات B2C.

لربط تطبيق B2C بموقعك وقناتك، اتبع هذه الخطوات.

1. انتقل إلى موقعك في منشئ موقع Commerce.
1. في جزء التنقل الأيسر، حدد **إعدادات الموقع** لتوسيعه.
1. ضمن **إعدادات الموقع**، حدد **القنوات**.
1. في النافذة الرئيسية، ضمن **القنوات‏‎**، حدد قناتك.
1. في جزء خصائص القناة إلى اليسار، حدد اسم تطبيق B2C من القائمة المنسدلة **تحديد تطبيق B2C**.
1. حدد **إغلاق**، ثم حدد **حفظ ونشر**.

## <a name="additional-b2c-information"></a>معلومات B2C إضافية

### <a name="customer-migration"></a>ترحيل العملاء

إذا كنت ترغب في ترحيل سجلات العملاء من نظام موفر الهوية السابق، فيرجى العمل مع فريق Dynamics 365 Commerce لمراجعة احتياجات ترحيل العملاء.

للحصول على وثائق Azure AD B2C إضافة حول ترحيل العملاء، راجع [ترحيل العملاء إلى Azure Active Directory B2C](/azure/active-directory-b2c/active-directory-b2c-user-migration).

### <a name="custom-policies"></a>سياسات مخصصة

للحصول على معلومات إضافية حول تخصيص تفاعلات وتدفقات سياسة Azure AD B2C بما يتجاوز ما تقدمه سياسات B2C القياسية، راجع [السياسات المخصصة في Azure Active Directory B2C](/azure/active-directory-b2c/active-directory-b2c-overview-custom). 

### <a name="secondary-admin"></a>المسؤول الثانوي

يمكن إضافة حساب مسؤول ثانوي اختياري في قسم **المستخدمون** في مستأجر B2C. قد يكون هذا الحساب مباشرًا أو عامًا. إذا أردت مشاركة حساب عبر موارد الفريق، يمكن أيضًا إنشاء حساب عام. بسبب حساسية البيانات المخزنة في Azure AD B2C، يجب مراقبة حساب عام عن كثب وفق ممارسات الأمان الخاصة بشركتك.

## <a name="additional-resources"></a>الموارد الإضافية

[تكوين اسم مجالك](configure-your-domain-name.md)

[نشر مستأجر التجارة الإلكترونية الجديد](deploy-ecommerce-site.md)

[إنشاء موقع تجارة إلكترونية](create-ecommerce-site.md)

[إقران موقع Dynamics 365 Commerce بقناة عبر الإنترنت](associate-site-online-store.md)

[إدارة ملفات robots.txt](manage-robots-txt-files.md)

[تحميل عناوين URL لإعادة التوجيه‬ بشكل مجمع](upload-bulk-redirects.md)

[إعداد صفحات مخصصة لعمليات تسجيل دخول المستخدمين](custom-pages-user-logins.md)

[تكوين مستأجرين متعددين لمتاجرة عمل-مستهلك في بيئة Commerce](configure-multi-B2C-tenants.md)

[إضافة الدعم إلى شبكة تسليم المحتوى (CDN)](add-cdn-support.md)

[تمكين اكتشاف المتجر استنادًا إلى الموقع](enable-store-detection.md)


[!INCLUDE[footer-include](../includes/footer-banner.md)]
